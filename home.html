<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OpenWRT LTE Status Dashboard (Live)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts for Modern UI -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:600,400&display=swap" rel="stylesheet">
  <style>
    body {
      background: #181c24;
      color: #e3e6eb;
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .dashboard {
      max-width: 900px;
      margin: 32px auto;
      background: #232733;
      border-radius: 16px;
      box-shadow: 0 4px 24px #0005;
      padding: 32px;
    }
    h1, h2 {
      color: #4fc3f7;
      margin-top: 0;
    }
    .section {
      margin-bottom: 36px;
      padding-bottom: 28px;
      border-bottom: 1px solid #2d313c;
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      align-items: flex-start;
    }
    .card {
      background: #22252d;
      border-radius: 10px;
      padding: 18px 22px;
      box-shadow: 0 2px 6px #000a;
      margin-bottom: 18px;
      min-width: 220px;
      flex: 1;
    }
    .kv-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 15px;
    }
    .kv-table td {
      padding: 5px 8px;
      border-bottom: 1px solid #242835;
    }
    .kv-table td.key {
      color: #90caf9;
      font-weight: bold;
      width: 160px;
    }
    .kv-table td.value {
      color: #e3e6eb;
      text-align: right;
    }
    .badge {
      display: inline-block;
      padding: 2px 10px;
      background: #333c59;
      color: #ffb300;
      border-radius: 8px;
      font-size: 13px;
      margin-left: 8px;
    }
    .bar-container {
      background: #232733;
      border-radius: 8px;
      height: 18px;
      width: 100%;
      margin: 8px 0;
      overflow: hidden;
      box-shadow: 0 1px 4px #1115;
    }
    .bar {
      height: 100%;
      transition: width 0.7s;
    }
    .bar.signal { background: linear-gradient(90deg, #4caf50, #ffeb3b 80%, #ff5252 100%);}
    .bar.sinr { background: linear-gradient(90deg, #2196f3, #00bcd4);}
    .bar.rsrq { background: linear-gradient(90deg, #ffd600, #ff5252);}
    .bar.cqi { background: linear-gradient(90deg, #00e676, #3f51b5);}
    .bar.mcs { background: linear-gradient(90deg, #ff4081, #536dfe);}
    .bar.rank { background: linear-gradient(90deg, #ff9800, #00e676);}
    .bar.ca-cinr { background: linear-gradient(90deg, #ba68c8, #69f0ae);}
    .bar.ca-rsrq { background: linear-gradient(90deg, #ffa726, #ef5350);}
    .bar.ca-rsrp { background: linear-gradient(90deg, #7986cb, #ffb300);}
    .bar.ca-earfcn { background: linear-gradient(90deg, #80cbc4, #b2dfdb);}
    .bar.rssi { background: linear-gradient(90deg, #4caf50, #bdbdbd);}
    .label {
      font-size: 12px;
      color: #90caf9;
      margin-right: 12px;
    }
    .status-dot {
      height: 14px;
      width: 14px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
      vertical-align: middle;
    }
    .dot-success { background: #43e97b; }
    .dot-fail { background: #ff5252;}
    .dot-warn { background: #ffb300;}
    .dot-grey { background: #616161;}
    .polling-controls {
      margin-top: 10px;
      margin-bottom: 10px;
      text-align: right;
    }
    .polling-controls label {
      font-size: 13px;
      color: #90caf9;
      margin-right: 8px;
    }
    .polling-controls input {
      width: 60px;
      padding: 3px 5px;
      border-radius: 5px;
      border: none;
      background: #232733;
      color: #e3e6eb;
      font-size: 14px;
      margin-left: 6px;
      outline: none;
      box-shadow: 0 1px 4px #1115;
    }
    .band-change-controls {
      background: #232733;
      border-radius: 12px;
      padding: 14px 20px 9px 20px;
      margin-bottom: 18px;
      margin-top: 2px;
      border: 1px solid #2d313c;
      position: relative;
    }
    .band-change-controls label {
      font-size: 15px;
      color: #4fc3f7;
      margin-right: 10px;
      font-weight: bold;
    }
    .band-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 18px;
      margin-bottom: 8px;
      margin-top: 6px;
    }
    .band-checkbox {
      accent-color: #4fc3f7;
      width: 16px;
      height: 16px;
      margin-right: 4px;
      vertical-align: middle;
    }
    .band-btn-group {
      margin-top: 8px;
      display: flex;
      gap: 10px;
    }
    .band-btn {
      background: #4fc3f7;
      color: #232733;
      border: none;
      font-weight: bold;
      padding: 5px 15px;
      border-radius: 7px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .band-btn:hover {
      background: #2196f3;
      color: #fff;
    }
    .band-err {
      color: #ff5252;
      font-size: 14px;
      margin-left: 12px;
    }
    .band-success {
      color: #43e97b;
      font-size: 14px;
      margin-left: 12px;
    }
    /* ? Button for Band Help */
    .band-help-btn {
      background: #313b50;
      color: #4fc3f7;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 20px;
      font-weight: bold;
      margin-left: 6px;
      cursor: pointer;
      vertical-align: middle;
      transition: background 0.2s, color 0.2s;
      box-shadow: 0 1px 4px #111a;
    }
    .band-help-btn:hover {
      background: #4fc3f7;
      color: #232733;
    }
    /* Modal for Supported Band Combinations */
    .modal-band-help {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(18,22,34,0.96);
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.2s;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal-band-help-content {
      background: #242b3a;
      border-radius: 18px;
      padding: 32px 36px 28px 36px;
      max-width: 440px;
      min-width: 280px;
      box-shadow: 0 6px 32px #0009;
      color: #f3f7fa;
      text-align: center;
      position: relative;
    }
    .modal-band-help-content h3 {
      margin-top: 0;
      color: #4fc3f7;
      letter-spacing: 1px;
      font-size: 1.3em;
    }
    .modal-band-help-content .close-btn {
      position: absolute;
      top: 14px; right: 20px;
      background: none;
      border: none;
      font-size: 1.7em;
      color: #666;
      cursor: pointer;
      transition: color 0.15s;
    }
    .modal-band-help-content .close-btn:hover {
      color: #ff5252;
    }
    .band-combo-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 17px;
      margin-bottom: 8px;
      align-items: center;
    }
    .combo-chip {
      display: inline-block;
      background: linear-gradient(90deg, #4fc3f7 60%, #a0e060 100%);
      color: #232733;
      border-radius: 18px;
      padding: 7px 18px;
      font-weight: 600;
      font-size: 1.13em;
      margin: 0 2px;
      box-shadow: 0 2px 10px #0003;
      letter-spacing: 1px;
    }
    .combo-arrows {
      font-size: 1.2em;
      margin: 0 6px;
      color: #90caf9;
      vertical-align: middle;
    }
    .combo-desc {
      font-size: 0.94em;
      color: #c0d2f7;
      margin-top: 3px;
    }
    @media (max-width: 700px) {
      .flex-row { flex-direction: column;}
      .dashboard { padding: 12px;}
      .polling-controls { text-align: left;}
      .band-list {flex-direction:column;}
      .modal-band-help-content { padding: 18px 4vw 12px 4vw;}
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <h1>üåê OpenWRT LTE Router Dashboard</h1>
    <div class="polling-controls">
      <label for="pollingInterval">OPS (Update/sec):</label>
      <input type="number" min="0.2" max="10" step="0.1" id="pollingInterval" value="0.2" />
      <span style="color:#b0b6c4; font-size:12px;">(Lower value = faster updates)</span>
    </div>
    <div class="band-change-controls">
      <label>Select LTE Bands:</label>
      <button class="band-help-btn" id="bandHelpBtn" title="Supported band combinations">?</button>
      <div class="band-list" id="bandList"></div>
      <div class="band-btn-group">
        <button class="band-btn" id="applyBandsBtn">Apply Selected Bands</button>
        <span id="bandMsg"></span>
      </div>
    </div>
    <!-- Modal for band help -->
    <div class="modal-band-help" id="modalBandHelp">
      <div class="modal-band-help-content">
        <button class="close-btn" id="modalBandHelpClose" title="Close">&times;</button>
        <h3>Supported Band Combinations</h3>
        <div class="band-combo-list">
          <div>
            <span class="combo-chip">Band 1</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 1</span>
            <div class="combo-desc">Standard 2x Band 1 aggregation</div>
          </div>
          <div>
            <span class="combo-chip">Band 1</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 5</span>
            <div class="combo-desc">Mix urban (1) and rural (5) coverage</div>
          </div>
          <div>
            <span class="combo-chip">Band 3</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 3</span>
            <div class="combo-desc">Maximum throughput with Band 3</div>
          </div>
          <div>
            <span class="combo-chip">Band 3</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 5</span>
            <div class="combo-desc">Urban + rural: Band 3 and 5</div>
          </div>
          <div>
            <span class="combo-chip">Band 3</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 38</span>
            <div class="combo-desc">TDD+FDD aggregation (3 + 38)</div>
          </div>
          <div>
            <span class="combo-chip">Band 3</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 41</span>
            <div class="combo-desc">Performance boost via Band 41</div>
          </div>
          <div>
            <span class="combo-chip">Band 5</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 5</span>
            <div class="combo-desc">Rural coverage: 2x Band 5</div>
          </div>
          <div>
            <span class="combo-chip">Band 41</span>
            <span class="combo-arrows">&#8596;</span>
            <span class="combo-chip">Band 41</span>
            <div class="combo-desc">Extra capacity: 2x Band 41</div>
          </div>
        </div>
        <div style="margin-top:14px; color:#a0a0a0; font-size:0.95em;">
          <b>Tip:</b> Choose two bands according to your network and area for optimal Carrier Aggregation.
        </div>
      </div>
    </div>
    <div class="section flex-row">
      <div class="card">
        <h2>Modem & Network</h2>
        <table class="kv-table">
          <tr><td class="key">Provider</td><td class="value" id="provider"></td></tr>
          <tr><td class="key">PLMN</td><td class="value" id="plmn"></td></tr>
          <tr><td class="key">Network Type</td><td class="value" id="networkType"></td></tr>
          <tr><td class="key">4G Registered</td><td class="value" id="reg4g"></td></tr>
          <tr><td class="key">Roaming</td><td class="value" id="roaming"></td></tr>
          <tr><td class="key">Service Status</td><td class="value" id="svcStatus"></td></tr>
        </table>
      </div>
      <div class="card">
        <h2>Primary Band</h2>
        <table class="kv-table">
          <tr><td class="key">Cell ID</td><td class="value" id="cellId"></td></tr>
          <tr><td class="key">eNodeB</td><td class="value" id="enodeb"></td></tr>
          <tr><td class="key">PCI</td><td class="value" id="pci"></td></tr>
          <tr><td class="key">Band</td><td class="value" id="band"></td></tr>
          <tr><td class="key">EARFCN</td><td class="value" id="earfcn"></td></tr>
          <tr><td class="key">Primary BW</td><td class="value" id="pbw"></td></tr>
          <tr>
            <td class="key">Link Status</td>
            <td class="value" id="linkStatus"></td>
          </tr>
        </table>
      </div>
      <div class="card">
        <h2>Secondary Band</h2>
        <table class="kv-table">
          <tr><td class="key">Cell ID</td><td class="value" id="cellId2"></td></tr>
          <tr><td class="key">eNodeB</td><td class="value" id="enodeb2"></td></tr>
          <tr><td class="key">CA PCI</td><td class="value" id="caPci"></td></tr>
          <tr><td class="key">CA Band</td><td class="value" id="caBand"></td></tr>
          <tr><td class="key">CA EARFCN</td><td class="value" id="caEarfcn"></td></tr>
          <tr><td class="key">CA BW</td><td class="value" id="sbw"></td></tr>
          <tr>
            <td class="key">CA Active Status</td>
            <td class="value">
              <span id="caActiveDot" class="status-dot dot-grey"></span>
              <span id="caActiveText" style="font-weight:bold;color:#b0b6c4;">Loading...</span>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="section flex-row">
      <div class="card">
        <h2>Signal Strength</h2>
        <div class="label">Signal Level: <b id="signalLvl"></b></div>
        <div class="bar-container"><div class="bar signal" id="signalBar"></div></div>
        <div class="label">RSRP: <b id="rsrp"></b></div>
        <div class="bar-container"><div class="bar" id="rsrpBar" style="background:linear-gradient(90deg,#4caf50,#ffeb3b)"></div></div>
        <div class="label">RSSI: <b id="rssi"></b></div>
        <div class="bar-container"><div class="bar rssi" id="rssiBar"></div></div>
        <div class="label">RSRQ: <b id="rsrq"></b></div>
        <div class="bar-container"><div class="bar rsrq" id="rsrqBar"></div></div>
        <div class="label">SINR: <b id="sinr"></b></div>
        <div class="bar-container"><div class="bar sinr" id="sinrBar"></div></div>
      </div>
      <div class="card">
        <h2>Carrier Aggregation Signal</h2>
        <div class="label">CA RSRP: <b id="caRsrp"></b></div>
        <div class="bar-container"><div class="bar ca-rsrp" id="caRsrpBar"></div></div>
        <div class="label">CA RSRQ: <b id="caRsrq"></b></div>
        <div class="bar-container"><div class="bar ca-rsrq" id="caRsrqBar"></div></div>
        <div class="label">CA RSSI: <b id="caRssi"></b></div>
        <div class="bar-container"><div class="bar" id="caRssiBar" style="background:linear-gradient(90deg,#4fc3f7,#00bcd4)"></div></div>
        <div class="label">CA CINR: <b id="caCinr"></b></div>
        <div class="bar-container"><div class="bar ca-cinr" id="caCinrBar"></div></div>
      </div>
      <div class="card">
        <h2>Quality & Coding</h2>
        <div class="label">CQI: <b id="cqi"></b></div>
        <div class="bar-container"><div class="bar cqi" id="cqiBar"></div></div>
        <div class="label">MCS: <b id="mcs"></b></div>
        <div class="bar-container"><div class="bar mcs" id="mcsBar"></div></div>
        <div class="label">Rank: <b id="rank"></b></div>
        <div class="bar-container"><div class="bar rank" id="rankBar"></div></div>
      </div>
    </div>
    <div class="section">
      <h2>Raw Data & Status</h2>
      <table class="kv-table">
        <tr><td class="key">Network Type Num</td><td class="value" id="networkTypeNum"></td></tr>
        <tr><td class="key">Active Channel</td><td class="value" id="activeChannel"></td></tr>
        <tr><td class="key">LAC ID</td><td class="value" id="lacId"></td></tr>
        <tr><td class="key">PS/CS Status</td><td class="value" id="pscsStatus"></td></tr>
        <tr><td class="key">ACT</td><td class="value" id="act"></td></tr>
        <tr><td class="key">IP Stack</td><td class="value" id="ipstack"></td></tr>
        <tr><td class="key">3G Register Status</td><td class="value" id="reg3g"></td></tr>
        <tr><td class="key">2G Register Status</td><td class="value" id="reg2g"></td></tr>
        <tr><td class="key">GW All Band</td><td class="value" id="gwAllBand"></td></tr>
        <tr><td class="key">LTE All Band</td><td class="value" id="lteAllBand"></td></tr>
        <tr><td class="key">LTE Lock Band</td><td class="value" id="lteLockBand"></td></tr>
        <tr><td class="key">GW Lock Band</td><td class="value" id="gwLockBand"></td></tr>
        <tr><td class="key">TAC</td><td class="value" id="tac"></td></tr>
        <tr><td class="key">Operator</td><td class="value" id="operator"></td></tr>
        <tr><td class="key">RRC Status</td><td class="value" id="rrcStatus"></td></tr>
      </table>
    </div>
  </div>
  <script>
    // ==== Band Change Feature ====
    const BAND_NAMES = [
      { id: 1, api: "EUTRAN_BAND1", label: "Band 1" },
      { id: 3, api: "EUTRAN_BAND3", label: "Band 3" },
      { id: 5, api: "EUTRAN_BAND5", label: "Band 5" },
      { id: 38, api: "EUTRAN_BAND38", label: "Band 38" },
      { id: 41, api: "EUTRAN_BAND41", label: "Band 41" }
    ];
    let currentLockBands = [];
    function renderBandList(lockband = []) {
      const el = document.getElementById('bandList');
      el.innerHTML = "";
      BAND_NAMES.forEach(b => {
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.className = 'band-checkbox';
        cb.value = b.api;
        cb.id = 'band-cb-' + b.id;
        if (lockband.includes(b.api)) cb.checked = true;
        const lb = document.createElement('label');
        lb.setAttribute('for', cb.id);
        lb.style.cursor = "pointer";
        lb.appendChild(cb);
        lb.appendChild(document.createTextNode(' ' + b.label));
        el.appendChild(lb);
      });
    }
    function getSelectedBands() {
      return Array.from(document.querySelectorAll('.band-checkbox:checked')).map(el => el.value);
    }
    function setBandMsg(msg, success) {
      const el = document.getElementById('bandMsg');
      el.textContent = msg;
      el.className = success ? 'band-success' : 'band-err';
    }
    async function changeBands(sessionId, bands, cb) {
      try {
        setBandMsg("Applying bands...", true);
        const res = await fetch("http://192.168.1.1/cgi-bin/lua.cgi", {
          credentials: "omit",
          headers: {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0",
            "Accept": "*/*",
            "Accept-Language": "en-US,en;q=0.5",
            "Content-Type": "application/json",
            "X-Requested-With": "XMLHttpRequest",
            "Priority": "u=4",
            "Pragma": "no-cache",
            "Cache-Control": "no-cache"
          },
          referrer: "http://192.168.1.1/band.html",
          body: JSON.stringify({
            band: bands,
            method: "POST",
            cmd: 166,
            sessionId: sessionId
          }),
          method: "POST",
          mode: "cors"
        });
        const json = await res.json();
        if (json.success) {
          setBandMsg("Band change successful!", true);
          setTimeout(fetchLockBand, 700);
        } else {
          setBandMsg("Band change failed!", false);
        }
        if (cb) cb(json.success);
      } catch (e) {
        setBandMsg("Error communicating with router!", false);
        if (cb) cb(false);
      }
    }
    document.getElementById('applyBandsBtn').onclick = function() {
      const bands = getSelectedBands();
      if (!bands.length) {
        setBandMsg("Select at least one band!", false);
        return;
      }
      changeBands(sessionId, bands);
    };
    async function fetchLockBand() {
      if (!sessionId) return;
      try {
        const res = await fetch("http://192.168.1.1/cgi-bin/lua.cgi", {
          credentials: "omit",
          headers: {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0",
            "Accept": "*/*",
            "Accept-Language": "en-US,en;q=0.5",
            "Content-Type": "application/json",
            "X-Requested-With": "XMLHttpRequest",
            "Priority": "u=4",
            "Pragma": "no-cache",
            "Cache-Control": "no-cache"
          },
          referrer: "http://192.168.1.1/band.html",
          body: JSON.stringify({
            cmd: 165,
            method: "GET",
            sessionId: sessionId
          }),
          method: "POST",
          mode: "cors"
        });
        const json = await res.json();
        if (json.success) {
          currentLockBands = Array.isArray(json.lockband) ? json.lockband : [];
          renderBandList(currentLockBands);
        }
      } catch (e) {}
    }
    // ==== END Band Change Feature ====
    function getServiceStatusText(code) {
      switch (code) {
        case "2": return '<span class="badge">Connected</span>';
        case "1": return '<span class="badge" style="color:#43e97b;">Connecting</span>';
        default: return '<span class="badge" style="color:#ff5252;">Disconnected</span>';
      }
    }
    function setDot(dotEl, active) {
      dotEl.classList.remove('dot-success', 'dot-fail', 'dot-grey');
      dotEl.classList.add(active ? 'dot-success' : 'dot-fail');
    }
    const USERNAME = "sztozed";
    const PASSWORD = "e9665026ee2fd58788d7659e190a2e3e";
    let sessionId = null;
    let pollingTimeout = null;
    let pollingMs = 200;
    document.getElementById('pollingInterval').addEventListener('change', function() {
      let ops = parseFloat(this.value);
      if (isNaN(ops) || ops < 0.2) ops = 0.2;
      if (ops > 10) ops = 10;
      pollingMs = 1000 / ops;
      this.value = ops.toFixed(2);
      restartPolling();
    });
    async function fetchSessionId() {
      const res = await fetch("http://192.168.1.1/cgi-bin/lua.cgi", {
        credentials: "omit",
        headers: {
          "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0",
          "Accept": "text/plain, */*; q=0.01",
          "Accept-Language": "en-US,en;q=0.5",
          "Content-Type": "application/json; charset=UTF-8",
          "X-Requested-With": "XMLHttpRequest",
          "Priority": "u=0",
          "Pragma": "no-cache",
          "Cache-Control": "no-cache"
        },
        referrer: "http://192.168.1.1/login.html",
        body: JSON.stringify({
          cmd: 100,
          method: "POST",
          sessionId: "random",
          username: USERNAME,
          passwd: PASSWORD
        }),
        method: "POST",
        mode: "cors"
      });
      const data = await res.json();
      return data.sessionId;
    }
    async function fetchModemData(sessionId) {
      const res = await fetch("http://192.168.1.1/cgi-bin/lua.cgi", {
        credentials: "omit",
        headers: {
          "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0",
          "Accept": "text/plain, */*; q=0.01",
          "Accept-Language": "en-US,en;q=0.5",
          "Content-Type": "application/json; charset=UTF-8",
          "X-Requested-With": "XMLHttpRequest",
          "Pragma": "no-cache",
          "Cache-Control": "no-cache"
        },
        referrer: "http://192.168.1.1/index.html",
        body: JSON.stringify({
          cmd: 208,
          method: "GET",
          sessionId: sessionId
        }),
        method: "POST",
        mode: "cors"
      });
      const json = await res.json();
      return json.data;
    }
    function updateDashboard(data) {
      // CA
      const caActive = data.caModem?.ca_activ_status === 1 || data.caModem?.ca_activ_status === "1";
      setDot(document.getElementById("caActiveDot"), caActive);
      document.getElementById("caActiveText").textContent = caActive ? "Active" : "Inactive";
      document.getElementById("caActiveText").style.color = caActive ? "#4caf50" : "#ff5252";
      // Modem
      const m = data.modem || {};
      document.getElementById("provider").textContent = m.service_provide_name || "";
      document.getElementById("plmn").textContent = m.plmn || "";
      document.getElementById("networkType").textContent = m.network_type_str || "";
      document.getElementById("reg4g").textContent = m["4g_register_status"] === 1 || m["4g_register_status"] === "1" ? "Yes" : "No";
      document.getElementById("roaming").textContent = m.roam_status === 1 || m.roam_status === "1" ? "Yes" : "No";
      document.getElementById("svcStatus").innerHTML = getServiceStatusText(m.service_status);
      document.getElementById("linkStatus").innerHTML = (m.network_link_stauts === 1 || m.network_link_stauts === "1")
        ? '<span class="status-dot dot-success"></span>Connected'
        : '<span class="status-dot dot-fail"></span>Disconnected';
      document.getElementById("cellId").textContent = m.cell_id || "";
      document.getElementById("enodeb").textContent = m.enodebid || "";
      document.getElementById("pci").textContent = m.pci || "";
      document.getElementById("band").textContent = m.band || "";
      document.getElementById("earfcn").textContent = m.earfcn || "";
      document.getElementById("pbw").textContent = m.pbw || "";
      document.getElementById("cellId2").textContent = m.cell_id || "";
      document.getElementById("enodeb2").textContent = m.enodebid || "";
      document.getElementById("caPci").textContent = m.ca_pci || "";
      document.getElementById("caBand").textContent = m.sband || "";
      document.getElementById("caEarfcn").textContent = m.ca_earfcn || "";
      document.getElementById("sbw").textContent = m.sbw || "";
      document.getElementById("signalLvl").textContent = m.signal_lvl || "";
      document.getElementById("signalBar").style.width = ((Number(m.signal_lvl) || 0) / 5 * 100) + "%";
      document.getElementById("rsrp").textContent = m.rsrp || "";
      document.getElementById("rsrpBar").style.width = Math.max(0, Math.min(100, (140 + Number(m.rsrp || -140)) / 140 * 100)) + "%";
      document.getElementById("rssi").textContent = m.rssi || "";
      document.getElementById("rssiBar").style.width = Math.max(0, Math.min(100, (140 + Number(m.rssi || -140)) / 140 * 100)) + "%";
      document.getElementById("rsrq").textContent = m.rsrq || "";
      document.getElementById("rsrqBar").style.width = Math.max(0, Math.min(100, (20 + Number(m.rsrq || -20)) / 20 * 100)) + "%";
      document.getElementById("sinr").textContent = m.sinr || "";
      document.getElementById("sinrBar").style.width = Math.max(0, Math.min(100, (Number(m.sinr || 0)/ 30 * 100))) + "%";
      document.getElementById("caRsrp").textContent = m.ca_rsrp || "";
      document.getElementById("caRsrpBar").style.width = Math.max(0, Math.min(100, (140 + Number(m.ca_rsrp || -140)) / 140 * 100)) + "%";
      document.getElementById("caRsrq").textContent = m.ca_rsrq || "";
      document.getElementById("caRsrqBar").style.width = Math.max(0, Math.min(100, (20 + Number(m.ca_rsrq || -20)) / 20 * 100)) + "%";
      document.getElementById("caRssi").textContent = m.ca_rssi || "";
      document.getElementById("caRssiBar").style.width = Math.max(0, Math.min(100, (140 + Number(m.ca_rssi || -140)) / 140 * 100)) + "%";
      document.getElementById("caCinr").textContent = m.ca_cinr || "";
      document.getElementById("caCinrBar").style.width = Math.max(0, Math.min(100, (Number(m.ca_cinr || 0)/ 30 * 100))) + "%";
      document.getElementById("cqi").textContent = m.cqi || "";
      document.getElementById("cqiBar").style.width = Math.max(0, Math.min(100, (Number(m.cqi || 0)/ 15 * 100))) + "%";
      document.getElementById("mcs").textContent = m.mcs || "";
      document.getElementById("mcsBar").style.width = Math.max(0, Math.min(100, (Number(m.mcs || 0)/ 30 * 100))) + "%";
      document.getElementById("rank").textContent = m.rank || "";
      document.getElementById("rankBar").style.width = Math.max(0, Math.min(100, (Number(m.rank || 0)/ 2 * 100))) + "%";
      document.getElementById("networkTypeNum").textContent = m.network_type_num || "";
      document.getElementById("activeChannel").textContent = m.active_channel || "";
      document.getElementById("lacId").textContent = m.lac_id || "";
      document.getElementById("pscsStatus").textContent = m.ps_cs_status || "";
      document.getElementById("act").textContent = m.act || "";
      document.getElementById("ipstack").textContent = m.ipstack_current || "";
      document.getElementById("reg3g").textContent = m["3g_register_status"] || "";
      document.getElementById("reg2g").textContent = m["2g_register_status"] || "";
      document.getElementById("gwAllBand").textContent = m.gw_all_band || "";
      document.getElementById("lteAllBand").textContent = m.lte_all_band || "";
      document.getElementById("lteLockBand").textContent = m.lte_lock_band || "";
      document.getElementById("gwLockBand").textContent = m.gw_lock_band || "";
      document.getElementById("tac").textContent = m.tac || "";
      document.getElementById("operator").textContent = m.operator || "";
      document.getElementById("rrcStatus").textContent = m.rrc_status || "";
    }
    async function pollRouterData() {
      if (!sessionId) {
        sessionId = await fetchSessionId();
        await fetchLockBand();
      }
      try {
        const data = await fetchModemData(sessionId);
        updateDashboard(data);
      } catch (e) {}
      pollingTimeout = setTimeout(pollRouterData, pollingMs);
    }
    function restartPolling() {
      clearTimeout(pollingTimeout);
      pollRouterData();
    }
    fetchSessionId().then(sid => {
      sessionId = sid;
      fetchLockBand();
      pollRouterData();
    });

    // Modal for Supported Band Combinations
    document.getElementById('bandHelpBtn').onclick = function() {
      document.getElementById('modalBandHelp').style.display = "flex";
    };
    document.getElementById('modalBandHelpClose').onclick = function() {
      document.getElementById('modalBandHelp').style.display = "none";
    };
    // Also close modal on outside click
    document.getElementById('modalBandHelp').onclick = function(e) {
      if (e.target === this) this.style.display = "none";
    };
  </script>
</body>
</html>
