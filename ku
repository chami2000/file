import"../chunks/DsnmJJEf.js";import{d as Mt,s as V,o as Ot,e as fe,a as Jt,c as Yt}from"../chunks/uOOQ6--2.js";import{p as Pe,w as We,g as e,x as Bt,V as Qt,c as m,k as o,r as t,e as c,t as U,h as f,i as Fe,j as N,y as gt,v as Ce,aL as pt,s as r,q as it,n as qe,o as Dt}from"../chunks/CAD32a6s.js";import{i as I}from"../chunks/Woehh_xG.js";import{s as ne}from"../chunks/Db3OXtV6.js";import{t as Z,b as $e,a as ze,f as Ct}from"../chunks/DYfJErdn.js";import{s as bt,a as Ke}from"../chunks/Cp1wERzu.js";/* empty css                */import{p as Rt,n as Xt}from"../chunks/BoyRJLbp.js";import"../chunks/YBVENdJV.js";import{e as Ze,i as jt}from"../chunks/x-Zjy3O5.js";import{i as eo}from"../chunks/D2HwBLWb.js";import{t as we}from"../chunks/CLr30HFR.js";import{h as ht}from"../chunks/43oG8ztk.js";import{s as Ut}from"../chunks/_H3cWxLC.js";import{e as to,c as wt,q as Gt,b as St}from"../chunks/GfFVhtxl.js";import{s as be,r as oo}from"../chunks/DZN20UDS.js";import{b as Vt}from"../chunks/DCuhF-d-.js";import{g as je}from"../chunks/CCPyAxK9.js";import{A as ro,c as ao}from"../chunks/ByCXgiqX.js";import{b as so}from"../chunks/RXfYWD2T.js";import{p as $t}from"../chunks/DEiwkT5d.js";import{r as Pt}from"../chunks/ROjD0baX.js";import{s as Ft,b as no}from"../chunks/DbLYNWVp.js";import{c as _t}from"../chunks/DeZp5sTZ.js";import{n as io,i as lo,s as ft,r as co}from"../chunks/Cq6C7IfR.js";import{w as nt}from"../chunks/DTPuyAiD.js";import{w as uo}from"../chunks/CeB6OijA.js";function vo(v,a){v.preventDefault(),a.onClose()}var fo=m("<p> </p>"),ho=m('<div><div><!></div> <div class="min-w-0 flex-1 toast-content svelte-1cpok13"><p> </p> <!></div> <button class="toast-close-btn flex-shrink-0 rounded-lg p-1.5 text-gray-400 transition-all duration-300 hover:text-white hover:bg-white/10 focus:ring-1 focus:ring-gray-600 focus:outline-none svelte-1cpok13" aria-label="Close notification"><svg class="h-4 w-4 svelte-1cpok13" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" class="svelte-1cpok13"></path></svg></button> <div class="absolute right-0 bottom-0 left-0 h-1 overflow-hidden rounded-b-xl bg-gray-900/50 svelte-1cpok13"><div></div></div></div>');function go(v,a){Pe(a,!0);const n=Bt(()=>a.toast.duration&&a.toast.duration>0?a.toast.duration:5e3),w={success:`<svg width="14" height="14" viewBox="0 0 16 16" fill="none">
			<path d="M13.5 4.5L6 12L2.5 8.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
		</svg>`,error:`<svg width="14" height="14" viewBox="0 0 16 16" fill="none">
			<path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
		</svg>`,warning:`<svg width="14" height="14" viewBox="0 0 16 16" fill="none">
			<path d="M8 1L15 14H1L8 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
			<path d="M8 6V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
			<circle cx="8" cy="12" r="0.5" fill="currentColor"/>
		</svg>`,info:`<svg width="14" height="14" viewBox="0 0 16 16" fill="none">
			<circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>
			<path d="M8 12V8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
			<circle cx="8" cy="5" r="0.5" fill="currentColor"/>
		</svg>`},j={success:{icon:"text-green-400",border:"border-green-500/30",text:"text-green-400",message:"text-gray-300"},error:{icon:"text-red-400",border:"border-red-500/30",text:"text-red-400",message:"text-gray-300"},warning:{icon:"text-yellow-400",border:"border-yellow-500/30",text:"text-yellow-400",message:"text-gray-300"},info:{icon:"text-blue-400",border:"border-blue-500/30",text:"text-blue-400",message:"text-gray-300"}};We(()=>{console.log("Toast effect running:",a.toast.title,"Duration:",e(n)),console.log(`Setting timeout for ${e(n)}ms for toast: ${a.toast.title}`);const u=setTimeout(()=>{console.log(`Auto-dismissing toast: ${a.toast.title}`),Qt(()=>a.onClose())},e(n));return()=>{console.log(`Clearing timeout for toast: ${a.toast.title}`),clearTimeout(u)}});var d=ho(),i=o(d),_=o(i);ht(_,()=>w[a.toast.type]),t(i);var x=c(i,2),D=o(x),y=o(D,!0);t(D);var q=c(D,2);{var T=u=>{var p=fo(),g=o(p,!0);t(p),U(()=>{ne(p,1,`text-xs ${j[a.toast.type].message??""} mt-0.5 line-clamp-2 opacity-90`,"svelte-1cpok13"),V(g,a.toast.message)}),f(u,p)};I(q,u=>{a.toast.message&&u(T)})}t(x);var z=c(x,2);z.__click=[vo,a];var E=c(z,2),R=o(E);t(E),t(d),U(()=>{ne(d,1,`toast-container group relative flex w-full items-center space-x-3 rounded-xl border ${j[a.toast.type].border??""} pointer-events-auto max-w-xs p-4 shadow-2xl sm:max-w-sm`,"svelte-1cpok13"),ne(i,1,`flex-shrink-0 ${j[a.toast.type].icon??""} toast-icon`,"svelte-1cpok13"),ne(D,1,`text-xs font-medium sm:text-sm ${j[a.toast.type].text??""} truncate`,"svelte-1cpok13"),V(y,a.toast.title),ne(R,1,`toast-progress h-full ${j[a.toast.type].icon??""} rounded-b-xl opacity-80 transition-all ease-linear`,"svelte-1cpok13"),Ut(R,`animation: shrink ${e(n)??""}ms linear forwards;`)}),Z(1,i,()=>$e,()=>({duration:400,delay:100,easing:to})),Z(2,i,()=>$e,()=>({duration:200,easing:wt})),Z(1,x,()=>ze,()=>({x:-30,duration:400,delay:150,easing:Gt})),Z(2,x,()=>ze,()=>({x:-20,duration:200,easing:wt})),Z(1,z,()=>$e,()=>({duration:300,delay:200,easing:St})),Z(2,z,()=>$e,()=>({duration:150,easing:wt})),Z(1,d,()=>ze,()=>({x:300,y:-50,duration:500,easing:St})),Z(2,d,()=>ze,()=>({x:300,y:-30,duration:300,easing:wt})),f(v,d),Fe()}Mt(["click"]);var po=m('<div class="pointer-events-none fixed right-3 top-20 z-[100000] flex w-full max-w-xs flex-col space-y-2 sm:right-2 sm:top-24 sm:max-w-sm sm:space-y-3"></div>');function bo(v,a){Pe(a,!1);const n=()=>Ke(we,"$toast",w),[w,j]=bt();function d(_){we.remove(_)}eo();var i=po();Ze(i,5,n,_=>_.id,(_,x)=>{go(_,{get toast(){return e(x)},onClose:()=>d(e(x).id)})}),t(i),f(v,i),Fe(),j()}async function mo(v,a,n,w,j,d){if(!e(a)||e(n))return;r(n,!0);const i=e(w);try{(await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:i})})).ok?(r(j,e(j).map(x=>({...x,isRead:!0})),!0),await d()):console.error("Failed to mark all as read")}catch(_){console.error("Failed to mark all as read",_)}finally{r(n,!1)}}function xo(v,a,n,w,j,d,i){if(!e(a)){n();return}r(w,!e(w)),r(j,!1),e(w)&&d(e(i))}function wo(v,a,n){r(a,!e(a)),r(n,!1)}function ko(v,a){console.log("Profile clicked"),r(a,!1),je("/user/profile")}function yo(v,a){console.log("Settings clicked"),r(a,!1),je("/user/settings")}async function _o(v,a,n,w,j,d,i){try{(await fetch("/api/auth/logout",{method:"POST"})).ok?(ao(),r(a,!1),r(n,null),r(w,[],!0),r(j,0),r(d,!1),r(i,!1),we.success("Logged out","See you next time!"),window.location.href="/"):we.error("Logout failed","Please try again")}catch(_){console.error("Logout error:",_),we.error("Logout failed","Network error")}}var Co=m('<div class="flex items-center gap-2 svelte-1elxaub"><div class="h-8 w-8 animate-pulse rounded-xl bg-gray-700/50 svelte-1elxaub"></div></div>'),jo=m('<span class="absolute top-0 right-0 inline-flex translate-x-1/2 -translate-y-1/2 transform items-center justify-center rounded-full bg-red-500 px-2 py-1 text-xs leading-none font-bold text-white svelte-1elxaub"> </span>'),So=(v,a,n)=>a(n),To=m('<span class="absolute inset-0 rounded-t-2xl bg-white/10 svelte-1elxaub"></span>'),No=m('<button><span class="relative z-10 capitalize svelte-1elxaub"> </span> <!></button>'),Mo=m('<svg class="mr-2 h-4 w-4 animate-spin svelte-1elxaub" viewBox="0 0 24 24" fill="none"><circle class="opacity-25 svelte-1elxaub" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75 svelte-1elxaub" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> <span class="svelte-1elxaub">Markingâ€¦</span>',1),Ao=Dt('<svg class="mr-1 h-4 w-4 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" class="svelte-1elxaub"></path></svg> Mark all as read',1),Io=m('<div class="flex h-32 items-center justify-center svelte-1elxaub"><div class="flex space-x-2 svelte-1elxaub"><div class="h-3 w-3 animate-bounce rounded-full bg-red-500 svelte-1elxaub"></div> <div class="h-3 w-3 animate-bounce rounded-full bg-red-500 svelte-1elxaub" style="animation-delay: 0.1s"></div> <div class="h-3 w-3 animate-bounce rounded-full bg-red-500 svelte-1elxaub" style="animation-delay: 0.2s"></div></div></div>'),qo=m('<div class="flex flex-col items-center justify-center px-4 py-12 svelte-1elxaub"><svg class="mb-3 h-12 w-12 text-gray-400 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" class="svelte-1elxaub"></path></svg> <p class="text-sm text-gray-400 svelte-1elxaub">No Notifications</p></div>'),zo=(v,a,n)=>a(e(n)),Eo=m('<a><div class="p-3 svelte-1elxaub"><div class="flex gap-2 svelte-1elxaub"><img alt="Notification"/> <div class="min-w-0 flex-1 svelte-1elxaub"><p> </p> <p> </p></div></div></div></a>'),Lo=m('<div class="p-2 text-center svelte-1elxaub"><button class="text-xs text-gray-400 transition-colors hover:text-red-400 focus:outline-none svelte-1elxaub">Load More</button></div>'),Bo=m('<div class="flex items-center justify-center py-4 svelte-1elxaub"><div class="h-4 w-4 animate-spin rounded-full border-2 border-red-400 border-t-transparent svelte-1elxaub"></div> <span class="ml-2 text-xs text-gray-400 svelte-1elxaub">Loading more...</span></div>'),Oo=m("<!> <!>",1),Do=m('<div class="animate-in fade-in-0 slide-in-from-top-2 fixed top-[60px] right-4 mt-2 w-64 overflow-hidden rounded-md bg-black/85 backdrop-blur-xl border border-white/15 shadow-2xl duration-300 z-50 svelte-1elxaub" style="box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6), 0 4px 16px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);"><div class="relative flex border-b border-white/15 svelte-1elxaub"><!> <span class="absolute bottom-0 left-0 h-0.5 bg-red-500 transition-all duration-300 ease-out svelte-1elxaub"></span></div> <div class="border-b border-white/15 p-2 svelte-1elxaub"><button class="flex w-full items-center justify-center px-3 py-1 text-xs font-medium text-gray-400 transition-colors hover:text-red-400 focus:outline-none disabled:opacity-60 disabled:cursor-not-allowed svelte-1elxaub"><!></button></div> <div class="scrollbar-thin max-h-[400px] min-h-[200px] overflow-y-auto svelte-1elxaub"><!></div></div>'),Ro=m('<img class="h-8 w-8 rounded-xl object-cover shadow-lg transition-transform duration-300 group-hover:scale-105 svelte-1elxaub"/>'),Wo=m('<div class="flex h-8 w-8 items-center justify-center rounded-xl bg-gradient-to-br from-red-500 to-red-600 text-sm font-bold text-white shadow-lg transition-transform duration-300 group-hover:scale-105 svelte-1elxaub"> </div>'),Po=m('<div class="avatar-enter relative svelte-1elxaub"><img class="h-12 w-12 rounded-xl object-cover shadow-lg ring-2 ring-white/20 svelte-1elxaub"/> <div class="absolute inset-0 rounded-xl bg-gradient-to-br from-red-400/20 to-transparent svelte-1elxaub"></div></div>'),Fo=m('<div class="avatar-enter relative svelte-1elxaub"><div class="flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-red-500 to-red-600 font-bold text-white shadow-lg ring-2 ring-white/20 svelte-1elxaub"> </div> <div class="absolute inset-0 rounded-xl bg-gradient-to-br from-white/10 to-transparent svelte-1elxaub"></div></div>'),Ho=m('<p class="truncate text-xs text-gray-300 opacity-80 svelte-1elxaub"> </p>'),Uo=m('<div class="mt-1 flex items-center gap-1 svelte-1elxaub"><svg class="h-3 w-3 text-red-400 svelte-1elxaub" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" class="svelte-1elxaub"></path></svg> <p class="text-xs text-gray-400 svelte-1elxaub"> </p></div>'),Go=()=>je("/user/loyalty"),Vo=()=>je("/user/profile/continue-watching"),$o=()=>je("/user/profile/watchlist"),Ko=()=>je("/user/profile/notifications"),Zo=m('<div class="dropdown-enter absolute top-full right-0 mt-3 w-64 rounded-2xl border border-white/10 bg-black/95 shadow-2xl backdrop-blur-xl overflow-hidden svelte-1elxaub" style="box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 10px 20px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);"><div class="arrow-enter absolute -top-2 right-6 h-4 w-4 rotate-45 border-t border-l border-white/10 bg-black/95 svelte-1elxaub"></div> <div class="header-enter relative overflow-hidden border-b border-white/10 bg-gradient-to-r from-red-500/10 via-red-600/5 to-transparent px-4 py-4 svelte-1elxaub"><div class="absolute inset-0 opacity-30 svelte-1elxaub"><div class="absolute inset-0 bg-[radial-gradient(circle_at_30%_40%,rgba(255,255,255,0.1),transparent_50%)] svelte-1elxaub"></div></div> <div class="relative flex items-center gap-3 svelte-1elxaub"><!> <div class="info-enter min-w-0 flex-1 svelte-1elxaub"><p class="truncate text-sm font-bold text-white svelte-1elxaub"> </p> <!> <!></div></div></div> <div class="py-1 svelte-1elxaub"><button class="menu-item-enter group flex w-full items-center gap-3 px-4 py-3 text-left transition-all duration-200 hover:bg-gradient-to-r hover:from-red-500/10 hover:to-transparent svelte-1elxaub" style="animation-delay: 0.1s"><div class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5 transition-all duration-200 group-hover:bg-red-500/20 group-hover:scale-105 svelte-1elxaub"><svg class="h-4 w-4 text-gray-400 transition-colors duration-200 group-hover:text-red-400 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" class="svelte-1elxaub"></path></svg></div> <div class="flex-1 svelte-1elxaub"><span class="block text-sm font-semibold text-white group-hover:text-red-100 svelte-1elxaub">My Profile</span> <span class="block text-xs text-gray-400 group-hover:text-red-300 svelte-1elxaub">View and edit profile</span></div></button> <button class="menu-item-enter group flex w-full items-center gap-3 px-4 py-3 text-left transition-all duration-200 hover:bg-gradient-to-r hover:from-blue-500/10 hover:to-transparent svelte-1elxaub" style="animation-delay: 0.15s"><div class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5 transition-all duration-200 group-hover:bg-blue-500/20 group-hover:scale-105 svelte-1elxaub"><svg class="h-4 w-4 text-gray-400 transition-colors duration-200 group-hover:text-blue-400 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" class="svelte-1elxaub"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" class="svelte-1elxaub"></path></svg></div> <div class="flex-1 svelte-1elxaub"><span class="block text-sm font-semibold text-white group-hover:text-blue-100 svelte-1elxaub">Settings</span> <span class="block text-xs text-gray-400 group-hover:text-blue-300 svelte-1elxaub">Manage preferences</span></div></button> <button class="menu-item-enter group flex w-full items-center gap-3 px-4 py-3 text-left transition-all duration-200 hover:bg-gradient-to-r hover:from-emerald-500/10 hover:to-transparent svelte-1elxaub" style="animation-delay: 0.2s"><div class="flex h-8 w-8 items-center justify-center rounded-lg bg-white/5 transition-all duration-200 group-hover:bg-emerald-500/20 group-hover:scale-105 svelte-1elxaub"><svg class="h-4 w-4 text-gray-400 transition-colors duration-200 group-hover:text-emerald-400 svelte-1elxaub" fill="currentColor" viewBox="0 -960 960 960"><path d="M444-200h70v-50q50-9 86-39t36-89q0-42-24-77t-96-61q-60-20-83-35t-23-41q0-26 18.5-41t53.5-15q32 0 50 15.5t26 38.5l64-26q-11-35-40.5-61T516-710v-50h-70v50q-50 11-78 44t-28 74q0 47 27.5 76t86.5 50q63 23 87.5 41t24.5 47q0 33-23.5 48.5T486-314q-33 0-58.5-20.5T390-396l-66 26q14 48 43.5 77.5T444-252v52Zm36 120q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" class="svelte-1elxaub"></path></svg></div> <div class="flex-1 svelte-1elxaub"><span class="block text-sm font-semibold text-white group-hover:text-emerald-100 svelte-1elxaub">Wallet</span> <span class="block text-xs text-gray-400 group-hover:text-emerald-300 svelte-1elxaub">Manage your wallet</span></div></button> <div class="section-enter border-t border-white/10 mt-1 pt-1 svelte-1elxaub" style="animation-delay: 0.25s"><div class="px-4 py-1 svelte-1elxaub"><p class="text-xs font-medium text-gray-500 uppercase tracking-wider svelte-1elxaub">Quick Actions</p></div> <button class="menu-item-enter group flex w-full items-center gap-3 px-4 py-2.5 text-left transition-all duration-200 hover:bg-gradient-to-r hover:from-green-500/10 hover:to-transparent svelte-1elxaub" style="animation-delay: 0.25s"><div class="flex h-7 w-7 items-center justify-center rounded-lg bg-white/5 transition-all duration-200 group-hover:bg-green-500/20 svelte-1elxaub"><svg class="h-3.5 w-3.5 text-gray-400 transition-colors duration-200 group-hover:text-green-400 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" class="svelte-1elxaub"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-1elxaub"></path></svg></div> <span class="text-sm font-medium text-gray-300 group-hover:text-green-100 svelte-1elxaub">Continue Watching</span></button> <button class="menu-item-enter group flex w-full items-center gap-3 px-4 py-2.5 text-left transition-all duration-200 hover:bg-gradient-to-r hover:from-purple-500/10 hover:to-transparent svelte-1elxaub" style="animation-delay: 0.3s"><div class="flex h-7 w-7 items-center justify-center rounded-lg bg-white/5 transition-all duration-200 group-hover:bg-purple-500/20 svelte-1elxaub"><svg class="h-3.5 w-3.5 text-gray-400 transition-colors duration-200 group-hover:text-purple-400 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" class="svelte-1elxaub"></path></svg></div> <span class="text-sm font-medium text-gray-300 group-hover:text-purple-100 svelte-1elxaub">Watchlist</span></button> <button class="menu-item-enter group flex w-full items-center gap-3 px-4 py-2.5 text-left transition-all duration-200 hover:bg-gradient-to-r hover:from-yellow-500/10 hover:to-transparent svelte-1elxaub" style="animation-delay: 0.35s"><div class="flex h-7 w-7 items-center justify-center rounded-lg bg-white/5 transition-all duration-200 group-hover:bg-yellow-500/20 svelte-1elxaub"><svg class="h-3.5 w-3.5 text-gray-400 transition-colors duration-200 group-hover:text-yellow-400 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM6 8v6c0 1.1.9 2 2 2h6a2 2 0 002-2V8H6z" class="svelte-1elxaub"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9z" class="svelte-1elxaub"></path></svg></div> <span class="text-sm font-medium text-gray-300 group-hover:text-yellow-100 svelte-1elxaub">Notifications</span></button></div></div> <div class="section-enter border-t border-white/10 bg-gradient-to-r from-red-500/5 to-transparent svelte-1elxaub" style="animation-delay: 0.4s"><button class="menu-item-enter group flex w-full items-center gap-3 px-4 py-3.5 text-left transition-all duration-200 hover:bg-red-500/10 svelte-1elxaub" style="animation-delay: 0.45s"><div class="flex h-8 w-8 items-center justify-center rounded-lg bg-red-500/10 transition-all duration-200 group-hover:bg-red-500/20 group-hover:scale-105 svelte-1elxaub"><svg class="h-4 w-4 text-red-400 transition-all duration-200 group-hover:text-red-300 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" class="svelte-1elxaub"></path></svg></div> <div class="flex-1 svelte-1elxaub"><span class="block text-sm font-semibold text-red-400 group-hover:text-red-300 svelte-1elxaub">Sign Out</span> <span class="block text-xs text-red-500/70 group-hover:text-red-400 svelte-1elxaub">End session</span></div></button></div></div>'),Jo=m('<div class="dropdown-container relative svelte-1elxaub"><button class="group relative p-2.5 text-gray-400 transition-all duration-300 hover:text-red-500 svelte-1elxaub"><svg class="h-6 w-6 transition-transform duration-300 group-hover:scale-110 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9z" class="svelte-1elxaub"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.73 21a2 2 0 0 1-3.46 0" class="svelte-1elxaub"></path></svg> <!></button> <!></div> <div class="dropdown-container relative svelte-1elxaub"><button class="group flex items-center gap-2 rounded-xl p-1.5 transition-all duration-300 hover:bg-white/10 svelte-1elxaub"><div class="relative svelte-1elxaub"><!> <div class="absolute inset-0 rounded-xl bg-gradient-to-br from-red-400 to-red-700 opacity-0 transition-opacity duration-300 group-hover:opacity-20 svelte-1elxaub"></div></div> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-1elxaub"></path></svg></button> <!></div>',1),Yo=m('<button class="rounded-md bg-gradient-to-r from-red-500 to-red-600 px-4 py-2 text-sm font-medium text-white shadow-lg transition-all duration-300 hover:scale-105 hover:from-red-600 hover:to-red-700 hover:shadow-red-500/25 svelte-1elxaub">Sign In</button>'),Qo=m('<header class="fixed top-0 right-0 left-0 z-50 border-b border-white/5 bg-black/90 backdrop-blur-xl svelte-1elxaub"><div class="flex w-full items-center justify-between py-3 pr-4 pl-6 svelte-1elxaub"><div class="flex items-center gap-6 svelte-1elxaub"><a href="/" class="group flex items-center svelte-1elxaub"><div class="relative svelte-1elxaub"><img src="/logo.png" alt="Kuudere" class="h-7 w-auto transition-all duration-300 group-hover:scale-105 sm:h-9 svelte-1elxaub"/> <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-red-500/20 to-transparent opacity-0 blur-xl transition-opacity duration-300 group-hover:opacity-100 svelte-1elxaub"></div></div></a> <button class="group hidden min-w-[320px] items-center gap-3 rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-left text-gray-300 backdrop-blur-sm transition-all duration-300 hover:border-white/20 hover:bg-white/10 hover:text-white sm:flex svelte-1elxaub"><svg class="h-4 w-4 text-gray-400 transition-colors duration-300 group-hover:text-red-400 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-1elxaub"></path></svg> <span class="text-sm font-medium svelte-1elxaub">Search anime...</span> <div class="ml-auto flex items-center space-x-1 text-xs text-gray-500 svelte-1elxaub"><kbd class="rounded border border-white/20 bg-white/10 px-2 py-1 text-xs font-medium svelte-1elxaub">âŒ˜</kbd> <kbd class="rounded border border-white/20 bg-white/10 px-2 py-1 text-xs font-medium svelte-1elxaub">S</kbd></div></button></div> <div class="flex items-center gap-1 svelte-1elxaub"><button class="rounded-xl p-2.5 text-gray-400 transition-all duration-300 hover:bg-white/10 hover:text-white sm:hidden svelte-1elxaub" aria-label="Search"><svg class="h-5 w-5 svelte-1elxaub" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" class="svelte-1elxaub"></path></svg></button> <!></div></div></header> <!>',1);function Xo(v,a){Pe(a,!0);const n=()=>Ke(Rt,"$page",w),[w,j]=bt();let d=N(!1),i=N(null),_=N(!0),x=N(!1),D=N("login"),y=N(!1),q=N(gt([])),T=N(0),z=N(!1),E=N("anime"),R=N(1),u=N(!0),p=N(!1),g=N(!1),b=N(!1),S=N(null);async function X(){try{const l=await fetch("/api/auth/user");if(l.ok){const M=await l.json();M.success?(r(d,!0),r(i,M.user,!0),ee()):(r(d,!1),r(i,null))}else r(d,!1),r(i,null)}catch(l){console.error("Failed to check auth status:",l),r(d,!1),r(i,null)}finally{r(_,!1)}}async function ee(){if(e(d))try{const l=await fetch("/api/notifications/count");if(l.ok){const M=await l.json();M.success&&r(T,M.total,!0)}}catch(l){console.error("Failed to load notification count:",l)}}async function J(l="anime",M=1,te=!1){if(e(d)){te?r(p,!0):r(z,!0);try{const W=await fetch(`/api/notifications/${l}?page=${M}`);if(W.ok){const ie=await W.json();ie.success&&(te?r(q,[...e(q),...ie.notifications],!0):(r(q,ie.notifications,!0),r(E,l,!0),r(R,1)),r(u,ie.has_more,!0),te&&r(R,M,!0))}}catch(W){console.error("Failed to load notifications:",W)}finally{r(z,!1),r(p,!1)}}}function A(){if(!e(S)||e(p)||!e(u))return;const{scrollTop:l,scrollHeight:M,clientHeight:te}=e(S);l+te>=M-100&&C()}function C(){e(p)||!e(u)||J(e(E),e(R)+1,!0)}Ot(()=>{X();let l=null;return e(d)&&(l=setInterval(()=>{ee()},3e4)),()=>{l&&clearInterval(l)}});function L(){r(D,"login"),r(x,!0)}function Y(){r(x,!1)}function ae(){r(x,!1),X(),we.success("Welcome!","Successfully logged in")}function $(l){l!==e(E)&&J(l)}function he(l){if(l.link&&l.link!=="#"){const M=n().url.pathname,te=new URL(l.link,window.location.origin);M.startsWith("/community/")&&te.pathname.startsWith("/community/")?(console.log("ðŸ”„ Force reload for same-section navigation:",l.link),window.location.href=l.link):je(l.link,{invalidateAll:!0})}r(y,!1)}function ve(l){l.target.closest(".dropdown-container")||(r(y,!1),r(b,!1))}function ke(l){l.key==="Escape"&&(r(y,!1),r(b,!1),r(x,!1))}function k(l){return l?.username?l.username.charAt(0).toUpperCase():l?.name?l.name.charAt(0).toUpperCase():"U"}function G(l){return l?.username||l?.name||"User"}var Je=Qo();fe("click",pt,ve),fe("keydown",pt,ke);var He=Ce(Je),Ye=o(He),me=o(Ye),xe=c(o(me),2);xe.__click=function(...l){a.onSearchClick?.apply(this,l)},t(me);var ge=c(me,2),Qe=o(ge);Qe.__click=function(...l){a.onSearchClick?.apply(this,l)};var lt=c(Qe,2);{var Se=l=>{var M=Co();f(l,M)},Oe=l=>{var M=it(),te=Ce(M);{var W=Q=>{var pe=Jo(),Ee=Ce(pe),Te=o(Ee);Te.__click=[xo,d,L,y,b,J,E];var Ue=c(o(Te),2);{var Le=P=>{var F=jo(),ce=o(F,!0);t(F),U(()=>V(ce,e(T))),f(P,F)};I(Ue,P=>{e(T)&&e(T)!==0&&P(Le)})}t(Te);var et=c(Te,2);{var tt=P=>{var F=Do(),ce=o(F),Me=o(ce);Ze(Me,16,()=>["community","anime","system"],jt,(K,de)=>{var Ie=No();Ie.__click=[So,$,de];var De=o(Ie),ot=o(De,!0);t(De);var _e=c(De,2);{var Be=Re=>{var rt=To();f(Re,rt)};I(_e,Re=>{e(E)===de&&Re(Be)})}t(Ie),U(()=>{ne(Ie,1,`relative z-10 flex-1 overflow-hidden py-3 text-sm font-medium transition-colors ${e(E)===de?"text-red-400":"text-gray-400 hover:text-white"}`,"svelte-1elxaub"),V(ot,de)}),f(K,Ie)});var re=c(Me,2);t(ce);var ye=c(ce,2),Ae=o(ye);Ae.__click=[mo,d,g,E,q,ee];var mt=o(Ae);{var ut=K=>{var de=Mo();qe(2),f(K,de)},At=K=>{var de=Ao();qe(),f(K,de)};I(mt,K=>{e(g)?K(ut):K(At,!1)})}t(Ae),t(ye);var Ve=c(ye,2),It=o(Ve);{var qt=K=>{var de=Io();f(K,de)},zt=K=>{var de=it(),Ie=Ce(de);{var De=_e=>{var Be=qo();f(_e,Be)},ot=_e=>{var Be=Oo(),Re=Ce(Be);Ze(Re,17,()=>e(q),jt,(H,B)=>{var ue=Eo();ue.__click=[zo,he,B];var at=o(ue),st=o(at),vt=o(st),Wt=c(vt,2),xt=o(Wt),Kt=o(xt,!0);t(xt);var Lt=c(xt,2),Zt=o(Lt,!0);t(Lt),t(Wt),t(st),t(at),t(ue),U(()=>{be(ue,"href",e(B).link),ne(ue,1,`notification-item block border-b border-white/10 transition-colors hover:bg-white/5 ${e(B).isRead?"opacity-60":""}`,"svelte-1elxaub"),be(vt,"src",e(B).image||"/placeholder.svg"),ne(vt,1,`${e(B).isCommunity?"h-8 w-8":"h-16 w-10"} rounded object-cover ${e(B).isRead?"opacity-70":""}`,"svelte-1elxaub"),ne(xt,1,`text-xs font-semibold line-clamp-2 ${e(B).isRead?"text-gray-400":"text-white"}`,"svelte-1elxaub"),V(Kt,e(B).message),ne(Lt,1,`mt-0.5 text-xs ${e(B).isRead?"text-gray-500":"text-gray-400"}`,"svelte-1elxaub"),V(Zt,e(B).time)}),f(H,ue)});var rt=c(Re,2);{var Et=H=>{var B=Lo(),ue=o(B);ue.__click=C,t(B),f(H,B)},se=H=>{var B=it(),ue=Ce(B);{var at=st=>{var vt=Bo();f(st,vt)};I(ue,st=>{e(p)&&st(at)},!0)}f(H,B)};I(rt,H=>{e(u)&&!e(p)?H(Et):H(se,!1)})}f(_e,Be)};I(Ie,_e=>{e(q).length===0?_e(De):_e(ot,!1)},!0)}f(K,de)};I(It,K=>{e(z)?K(qt):K(zt,!1)})}t(Ve),Vt(Ve,K=>r(S,K),()=>e(S)),t(F),U(()=>{Ut(re,`width: 33.333%; transform: translateX(${e(E)==="community"?"0":e(E)==="anime"?"100%":"200%"})`),Ae.disabled=e(g)}),fe("scroll",Ve,A),f(P,F)};I(et,P=>{e(y)&&P(tt)})}t(Ee);var ct=c(Ee,2),Ge=o(ct);Ge.__click=[wo,b,y];var dt=o(Ge),s=o(dt);{var h=P=>{var F=Ro();U(ce=>{be(F,"src",e(i).pfp||"/placeholder.svg"),be(F,"alt",ce)},[()=>G(e(i))]),f(P,F)},O=P=>{var F=Wo(),ce=o(F,!0);t(F),U(Me=>V(ce,Me),[()=>k(e(i))]),f(P,F)};I(s,P=>{e(i).pfp?P(h):P(O,!1)})}qe(2),t(dt);var le=c(dt,2);t(Ge);var oe=c(Ge,2);{var Ne=P=>{var F=Zo(),ce=c(o(F),2),Me=c(o(ce),2),re=o(Me);{var ye=se=>{var H=Po(),B=o(H);qe(2),t(H),U(ue=>{be(B,"src",e(i).pfp||"/placeholder.svg"),be(B,"alt",ue)},[()=>G(e(i))]),f(se,H)},Ae=se=>{var H=Fo(),B=o(H),ue=o(B,!0);t(B),qe(2),t(H),U(at=>V(ue,at),[()=>k(e(i))]),f(se,H)};I(re,se=>{e(i).pfp?se(ye):se(Ae,!1)})}var mt=c(re,2),ut=o(mt),At=o(ut,!0);t(ut);var Ve=c(ut,2);{var It=se=>{var H=Ho(),B=o(H,!0);t(H),U(()=>V(B,e(i).email)),f(se,H)};I(Ve,se=>{e(i).email&&se(It)})}var qt=c(Ve,2);{var zt=se=>{var H=Uo(),B=c(o(H),2),ue=o(B);t(B),t(H),U(()=>V(ue,`Joined ${e(i).ago??""}`)),f(se,H)};I(qt,se=>{e(i).ago&&se(zt)})}t(mt),t(Me),t(ce);var K=c(ce,2),de=o(K);de.__click=[ko,b];var Ie=c(de,2);Ie.__click=[yo,b];var De=c(Ie,2);De.__click=[Go];var ot=c(De,2),_e=c(o(ot),2);_e.__click=[Vo];var Be=c(_e,2);Be.__click=[$o];var Re=c(Be,2);Re.__click=[Ko],t(ot),t(K);var rt=c(K,2),Et=o(rt);Et.__click=[_o,d,i,q,T,y,b],t(rt),t(F),U(se=>V(At,se),[()=>G(e(i))]),f(P,F)};I(oe,P=>{e(b)&&P(Ne)})}t(ct),U(()=>ne(le,0,`h-4 w-4 text-gray-400 transition-all duration-300 group-hover:text-white ${e(b)?"rotate-180":""}`,"svelte-1elxaub")),f(Q,pe)},ie=Q=>{var pe=Yo();pe.__click=L,f(Q,pe)};I(te,Q=>{e(d)&&e(i)?Q(W):Q(ie,!1)},!0)}f(l,M)};I(lt,l=>{e(_)?l(Se):l(Oe,!1)})}t(ge),t(Ye),t(He);var Xe=c(He,2);ro(Xe,{get isOpen(){return e(x)},onClose:Y,get initialMode(){return e(D)},onSubmit:ae}),f(v,Je),Fe(),j()}Mt(["click"]);var er=(v,a,n)=>a(e(n),v),tr=m('<div class="absolute top-1/2 -right-1 h-6 w-1 -translate-y-1/2 rounded-full bg-white"></div>'),or=m('<button><div class="transition-transform duration-300 group-hover:scale-110"><!></div> <!> <div class="pointer-events-none absolute left-full z-50 ml-4 rounded-xl border border-white/10 bg-black/95 px-3 py-2 text-sm whitespace-nowrap text-white opacity-0 shadow-xl backdrop-blur-xl transition-all duration-300 group-hover:opacity-100"> <div class="absolute top-1/2 right-full -translate-y-1/2 border-4 border-transparent border-r-black/95"></div></div></button>'),rr=(v,a,n)=>a(n,v),ar=m('<div class="absolute top-1/2 -right-1 h-6 w-1 -translate-y-1/2 rounded-full bg-white"></div>'),sr=(v,a,n)=>a(e(n),v),nr=m('<div class="absolute top-0 left-1/2 h-1 w-8 -translate-x-1/2 rounded-full bg-gradient-to-r from-red-500 to-red-600"></div>'),ir=m('<button><div><!></div> <span class="text-xs font-medium transition-colors duration-300"> </span> <!></button>'),lr=m('<aside class="fixed top-16 bottom-0 left-0 z-40 hidden w-16 flex-col border-r border-white/5 bg-black/90 backdrop-blur-xl lg:flex"><div class="flex flex-1 flex-col justify-center"><nav class="flex flex-col items-center space-y-2 px-2"></nav></div> <div class="flex flex-col items-center px-2 pb-4"><button><div class="transition-transform duration-300 group-hover:scale-110 group-hover:rotate-90"><!></div> <!> <div class="pointer-events-none absolute left-full z-50 ml-4 rounded-xl border border-white/10 bg-black/95 px-3 py-2 text-sm whitespace-nowrap text-white opacity-0 shadow-xl backdrop-blur-xl transition-all duration-300 group-hover:opacity-100"> <div class="absolute top-1/2 right-full -translate-y-1/2 border-4 border-transparent border-r-black/95"></div></div></button></div></aside> <nav><div class="flex items-center justify-around px-2 py-3"></div></nav>',1);function cr(v,a){Pe(a,!0);const n=()=>Ke(Rt,"$page",w),[w,j]=bt(),d=[{name:"Home",href:"/",icon:`<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
			</svg>`},{name:"Search",href:"/search",icon:`<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
			</svg>`},{name:"Schedule",href:"/schedule",icon:`<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
			</svg>`},{name:"Community",href:"/community",icon:`<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
			</svg>`}],i={name:"Settings",href:"/user/settings",icon:`<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
		</svg>`},_=[...d,i];function x(A){return A==="/"?n().url.pathname==="/":n().url.pathname.startsWith(A)}function D(A,C){A.href&&A.href!=="#"&&je(A.href)}var y=lr(),q=Ce(y),T=o(q),z=o(T);Ze(z,21,()=>d,jt,(A,C)=>{var L=or();L.__click=[er,D,C];var Y=o(L),ae=o(Y);ht(ae,()=>e(C).icon),t(Y);var $=c(Y,2);{var he=k=>{var G=tr();f(k,G)};I($,k=>{x(e(C).href)&&k(he)})}var ve=c($,2),ke=o(ve);qe(),t(ve),t(L),U((k,G)=>{ne(L,1,`group relative flex h-12 w-12 items-center justify-center rounded-2xl transition-all duration-300 ${k??""} ${G??""}`),be(L,"title",e(C).name),V(ke,`${e(C).name??""} `)},[()=>x(e(C).href)?"scale-105 bg-red-500/20 text-red-300 shadow-lg shadow-red-500/20":"text-gray-400 hover:scale-105 hover:bg-white/10 hover:text-white",()=>x(e(C).href)?"border border-red-500/30":"border border-transparent"]),f(A,L)}),t(z),t(T);var E=c(T,2),R=o(E);R.__click=[rr,D,i];var u=o(R),p=o(u);ht(p,()=>i.icon),t(u);var g=c(u,2);{var b=A=>{var C=ar();f(A,C)};I(g,A=>{x(i.href)&&A(b)})}var S=c(g,2),X=o(S);qe(),t(S),t(R),t(E),t(q);var ee=c(q,2),J=o(ee);Ze(J,21,()=>_,jt,(A,C)=>{var L=ir();L.__click=[sr,D,C];var Y=o(L),ae=o(Y);ht(ae,()=>e(C).icon),t(Y);var $=c(Y,2),he=o($,!0);t($);var ve=c($,2);{var ke=k=>{var G=nr();f(k,G)};I(ve,k=>{x(e(C).href)&&k(ke)})}t(L),U((k,G)=>{ne(L,1,`group flex flex-col items-center gap-1 rounded-2xl px-3 py-2 transition-all duration-300 ${k??""}`),ne(Y,1,`transition-all duration-300 group-hover:scale-110 ${G??""}`),V(he,e(C).name)},[()=>x(e(C).href)?"bg-red-500/10 text-red-400":"text-gray-400 hover:bg-white/10 hover:text-white",()=>x(e(C).href)?"scale-110":""]),f(A,L)}),t(J),t(ee),U((A,C,L)=>{ne(R,1,`group relative flex h-12 w-12 items-center justify-center rounded-2xl transition-all duration-300 ${A??""} ${C??""}`),be(R,"title",i.name),V(X,`${i.name??""} `),ne(ee,1,`fixed right-0 bottom-0 left-0 z-50 border-t border-white/10 bg-black/95 backdrop-blur-xl lg:hidden ${L??""}`)},[()=>x(i.href)?"scale-105 bg-red-500/20 text-red-300 shadow-lg shadow-red-500/20":"text-gray-400 hover:scale-105 hover:bg-white/10 hover:text-white",()=>x(i.href)?"border border-red-500/30":"border border-transparent",()=>n().url.pathname.startsWith("/chat/")?"hidden":""]),f(v,y),Fe(),j()}Mt(["click"]);function dr(v,a,n){e(a)?.viewAllUrl&&(je(e(a).viewAllUrl),n.onClose())}function ur(v,a){v.target===v.currentTarget&&a.onClose()}var vr=(v,a)=>{v.key==="Escape"&&a.onClose()},fr=v=>v.stopPropagation(),hr=()=>{document.getElementById("image-search-input")?.click()},gr=Dt('<svg class="h-4 w-4 animate-spin text-red-500" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>'),pr=Dt('<svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm40-80h480L570-480 450-320l-90-120-120 160Zm-40 80v-560 560Z"></path></svg>'),br=m('<li class="flex items-center justify-center py-12"><div class="flex flex-col items-center space-y-3 text-gray-400"><svg class="h-8 w-8 animate-spin text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span class="text-sm font-medium">Searching for anime...</span></div></li>'),mr=m('<li class="px-4 py-8 text-center"><svg class="mx-auto mb-4 h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0120 12a8 8 0 10-2.343 5.657l2.343 2.343"></path></svg> <p class="font-medium text-gray-300">No anime found</p> <p class="mt-1 text-sm text-gray-500">Try different keywords</p></li>'),xr=(v,a,n)=>a(e(n)),wr=(v,a,n)=>{v.key==="Enter"&&a(e(n))},kr=m('<li class="flex cursor-pointer items-center space-x-4 border-b border-gray-700/30 px-4 py-3 transition-all duration-200 last:border-b-0 hover:bg-gray-700/50" role="option" tabindex="0" aria-selected="false"><div class="flex-shrink-0"><img class="h-16 w-12 rounded object-cover shadow-lg" loading="lazy"/></div> <div class="min-w-0 flex-1"><h3 class="mb-1 truncate text-base font-medium text-white"> </h3> <p class="truncate text-sm text-gray-400"> </p></div> <div class="flex-shrink-0 text-gray-500"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></div></li>'),yr=m('<li class="border-t border-gray-700/30"><button class="flex w-full cursor-pointer items-center justify-center space-x-2 px-4 py-3 transition-all duration-200 hover:bg-red-500/10 group"><span class="text-sm font-medium text-red-400 group-hover:text-red-300"> </span> <svg class="h-4 w-4 text-red-400 group-hover:text-red-300 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg></button></li>'),_r=m("<!> <!>",1),Cr=m('<ul id="search-results" class="scrollbar-thin scrollbar-thumb-red-500 scrollbar-thumb-rounded mt-2 flex max-h-[50dvh] flex-col overflow-y-auto rounded-xl bg-[#1a1a1f] svelte-jfym0o" role="listbox"><!></ul>'),jr=m('<div class="fixed inset-0 z-50 flex min-h-full items-start sm:items-center justify-center bg-black/80 p-4 text-center backdrop-blur-sm" role="dialog" aria-modal="true" aria-labelledby="search-title" tabindex="0"><div class="max-h-[68dvh] w-full max-w-2xl transform text-left transition-all" role="button" tabindex="0" aria-label="Search dialog"><div class="relative mx-auto flex max-w-[600px] flex-col rounded-lg shadow-2xl"><div class="flex justify-between py-1"><div class="flex items-center gap-2 px-2"><p class="my-1 font-semibold text-white">For quick access :</p> <div class="rounded-md bg-[#1a1a1f] px-2 py-1 text-xs font-bold text-white">CTRL</div> <span class="text-white">+</span> <div class="rounded-md bg-[#1a1a1f] px-2 py-1 text-xs font-bold text-white">S</div></div> <button class="px-2 text-gray-400 transition-colors hover:text-white" aria-label="Close search" tabindex="0"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <div class="relative flex items-center rounded-xl bg-[#1a1a1f] text-base font-medium focus-within:ring-0 focus-within:outline-none"><input class="w-full border-0 bg-transparent p-4 pr-14 font-sans text-white outline-none focus:border-0 focus:ring-0 focus:outline-none" placeholder="Search Anime..." autocomplete="off" type="text" role="combobox" aria-controls="search-results" aria-autocomplete="list"/> <input id="image-search-input" type="file" accept="image/*" class="hidden"/> <button type="button" class="absolute right-3 text-gray-400 hover:text-white p-1 rounded transition-colors flex items-center gap-2 relative group" aria-label="Search by image"><!> <span class="pointer-events-none absolute top-full right-0 mt-2 hidden md:block whitespace-nowrap rounded-md border border-zinc-700 bg-black/90 px-2 py-1 text-xs text-white opacity-0 group-hover:opacity-100">Search by image</span></button></div> <!></div></div></div>');function Sr(v,a){Pe(a,!0);let n=$t(a,"isOpen",3,!1),w=N(""),j=N(!1),d=N(gt([])),i=N(null),_=N(!1),x=N(null),D=N(void 0);async function y(g){if(!g.trim()){r(d,[],!0),r(i,null),r(_,!1);return}r(j,!0),r(_,!0);try{const b=await fetch(`/api/search?q=${encodeURIComponent(g)}`),S=await b.json();S.success?(r(d,S.results||[],!0),r(i,S,!0)):(r(d,[],!0),r(i,null),b.status!==404&&we.error("Search Error",S.error||"Failed to search"))}catch(b){console.error("Search error:",b),r(d,[],!0),r(i,null),we.error("Network Error","Failed to connect to search service")}finally{r(j,!1)}}function q(){e(x)&&clearTimeout(e(x)),r(x,setTimeout(()=>{y(e(w))},300),!0)}function T(g){je(`/anime/${g.id}`),a.onClose()}function z(g){g.key==="Escape"&&a.onClose()}async function E(g){const b=g.currentTarget;if(!b.files||b.files.length===0)return;const S=b.files[0];r(d,[],!0),r(i,null),r(_,!0),r(j,!0);try{const X=new FormData;X.append("image",S);const J=await(await fetch("/api/search/by-image",{method:"POST",body:X})).json();J?.success?(r(d,J.results||[],!0),r(i,{success:!0,results:e(d),total:e(d).length,displayed:e(d).length,query:"by-image",hasMore:!1,viewAllUrl:"/search"},!0)):we.error("Image Search Failed",J?.error||"No results found")}catch{we.error("Network Error","Failed to upload image")}finally{r(j,!1),b.value=""}}Pt(()=>{n()?(r(w,""),r(d,[],!0),r(i,null),r(_,!1),r(j,!1),setTimeout(()=>{e(D)&&e(D).focus()},100)):e(x)&&clearTimeout(e(x))}),Pt(()=>{e(w).trim()?q():(r(d,[],!0),r(i,null),r(_,!1))});var R=it();fe("keydown",pt,z);var u=Ce(R);{var p=g=>{var b=jr();b.__click=[ur,a],b.__keydown=[vr,a];var S=o(b);S.__click=[fr],S.__keydown=z;var X=o(S),ee=o(X),J=c(o(ee),2);J.__click=function(...k){a.onClose?.apply(this,k)},t(ee);var A=c(ee,2),C=o(A);oo(C),Vt(C,k=>r(D,k),()=>e(D));var L=c(C,2);L.__change=E;var Y=c(L,2);Y.__click=[hr];var ae=o(Y);{var $=k=>{var G=gr();f(k,G)},he=k=>{var G=pr();f(k,G)};I(ae,k=>{e(j)?k($):k(he,!1)})}qe(2),t(Y),t(A);var ve=c(A,2);{var ke=k=>{var G=Cr(),Je=o(G);{var He=me=>{var xe=br();f(me,xe)},Ye=me=>{var xe=it(),ge=Ce(xe);{var Qe=Se=>{var Oe=mr();f(Se,Oe)},lt=Se=>{var Oe=_r(),Xe=Ce(Oe);Ze(Xe,19,()=>e(d),te=>te.id,(te,W,ie)=>{var Q=kr();Q.__click=[xr,T,W],Q.__keydown=[wr,T,W];var pe=o(Q),Ee=o(pe);t(pe);var Te=c(pe,2),Ue=o(Te),Le=o(Ue,!0);t(Ue);var et=c(Ue,2),tt=o(et,!0);t(et),t(Te),qe(2),t(Q),U(()=>{be(Q,"aria-label",e(W).title),be(Ee,"src",e(W).coverImage||"/placeholder.svg?height=80&width=60"),be(Ee,"alt",e(W).title),V(Le,e(W).title),V(tt,e(W).details)}),Z(1,Q,()=>ze,()=>({y:20,duration:300,delay:e(ie)*50})),f(te,Q)});var l=c(Xe,2);{var M=te=>{var W=yr(),ie=o(W);ie.__click=[dr,i,a];var Q=o(ie),pe=o(Q);t(Q),qe(2),t(ie),t(W),U(()=>V(pe,`View All Results (${e(i).total??""})`)),Z(1,ie,()=>ze,()=>({y:20,duration:300,delay:e(d).length*50+100})),f(te,W)};I(l,te=>{e(i)?.hasMore&&e(i)?.viewAllUrl&&te(M)})}f(Se,Oe)};I(ge,Se=>{e(_)&&e(d).length===0&&e(w).trim()?Se(Qe):Se(lt,!1)},!0)}f(me,xe)};I(Je,me=>{e(j)?me(He):me(Ye,!1)})}t(G),Z(1,G,()=>ze,()=>({y:-10,duration:200})),Z(2,G,()=>ze,()=>({y:-10,duration:150})),f(k,G)};I(ve,k=>{(e(w).trim()||e(_))&&k(ke)})}t(X),t(S),t(b),U(k=>be(C,"aria-expanded",k),[()=>e(w).trim()?"true":"false"]),so(C,()=>e(w),k=>r(w,k)),Z(1,S,()=>$e,()=>({start:.95,duration:300,easing:St})),Z(2,S,()=>$e,()=>({start:.95,duration:200,easing:Gt})),Z(1,b,()=>Ct,()=>({duration:200})),Z(2,b,()=>Ct,()=>({duration:200})),f(g,b)};I(u,g=>{n()&&g(p)})}f(v,R),Fe()}Mt(["click","keydown","change"]);var Tr=m('<button class="confirmation-btn confirmation-btn-cancel svelte-1yu3f53"><span class="svelte-1yu3f53"> </span></button>'),Nr=m('<div class="confirmation-backdrop svelte-1yu3f53" role="dialog" aria-label="Close dialog" tabindex="0"><div class="confirmation-dialog svelte-1yu3f53" role="alertdialog" aria-modal="true" aria-labelledby="dialog-title" aria-describedby="dialog-description" tabindex="0"><button class="confirmation-close-btn svelte-1yu3f53" aria-label="Close dialog" tabindex="0"><svg class="confirmation-close-icon svelte-1yu3f53" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <div class="confirmation-content svelte-1yu3f53"><div class="confirmation-text svelte-1yu3f53"><h2 id="dialog-title" class="confirmation-title svelte-1yu3f53"> </h2> <p id="dialog-description" class="confirmation-message svelte-1yu3f53"><!></p></div> <div class="confirmation-buttons svelte-1yu3f53"><!> <button class="confirmation-btn confirmation-btn-confirm svelte-1yu3f53"><span class="svelte-1yu3f53"> </span></button></div></div></div></div>');function Mr(v,a){Pe(a,!0);const n=()=>Ke(_t,"$confirmation",w),[w,j]=bt();function d(){n().onConfirm&&n().onConfirm(),_t.hide()}function i(){n().onCancel&&n().onCancel(),_t.hide()}function _(T){T.key==="Escape"?i():T.key==="Enter"&&d()}function x(){i()}We(()=>{if(n().show){const T=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=T}}});var D=it();fe("keydown",pt,_);var y=Ce(D);{var q=T=>{var z=Nr(),E=o(z),R=o(E),u=c(R,2),p=o(u),g=o(p),b=o(g,!0);t(g);var S=c(g,2),X=o(S);ht(X,()=>n().message),t(S),t(p);var ee=c(p,2),J=o(ee);{var A=ae=>{var $=Tr(),he=o($),ve=o(he,!0);t(he),t($),U(()=>V(ve,n().cancelText)),fe("click",$,i),f(ae,$)};I(J,ae=>{n().showCancel&&ae(A)})}var C=c(J,2),L=o(C),Y=o(L,!0);t(L),t(C),t(ee),t(u),t(E),t(z),U(()=>{V(b,n().title),V(Y,n().confirmText)}),fe("click",R,i),fe("click",C,d),Z(3,E,()=>$e,()=>({duration:300,start:.95,easing:St})),fe("click",E,Ft(function(ae){no.call(this,a,ae)})),fe("keydown",E,Ft(_)),Z(3,z,()=>Ct,()=>({duration:200})),fe("click",z,x),fe("keydown",z,_),f(T,z)};I(y,T=>{n().show&&T(q)})}f(v,D),Fe(),j()}var Ar=m('<div><div class="toast-header svelte-7uclrp"><div class="toast-image svelte-7uclrp"><img alt="Notification" class="svelte-7uclrp"/></div> <div class="toast-content svelte-7uclrp"><h4 class="toast-title svelte-7uclrp"> </h4> <p class="toast-message svelte-7uclrp"> </p></div></div> <div class="toast-actions svelte-7uclrp"><div class="toast-btn-wrapper svelte-7uclrp"><button class="toast-action-btn toast-view-btn svelte-7uclrp" title="Watch/View"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-7uclrp"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> View</button></div> <div class="toast-btn-wrapper svelte-7uclrp"><button class="toast-action-btn toast-dismiss-btn svelte-7uclrp" title="Dismiss"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-7uclrp"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> Dismiss</button></div></div></div>'),Ir=m('<div class="toast-container svelte-7uclrp"></div>');function qr(v,a){Pe(a,!0);const n=$t(a,"userId",3,null);let w=N(gt([])),j=N(!1),d=N(gt([])),i=new Set,_=!1;const x=io.subscribe(u=>{console.log("ðŸ”” GlobalNotifications: Received notifications:",u),console.log("ðŸ”” GlobalNotifications: Current processed IDs:",Array.from(i));const p=u.filter(g=>{const b=g.id||g.message+g.time,S=!i.has(b);return console.log(`ðŸ”” GlobalNotifications: Checking notification ${b}, isNew: ${S}`),S});console.log("ðŸ”” GlobalNotifications: New notifications to show:",p),p.forEach(g=>{const b=g.id||g.message+g.time;console.log(`ðŸ”” GlobalNotifications: Processing new notification ${b}`),i.add(b),q(g)}),r(w,u,!0)}),D=lo.subscribe(u=>{r(j,u,!0)});We(()=>{n()&&(console.log("ðŸ”” GlobalNotifications: userId changed to:",n()),y())}),We(()=>{n()&&typeof Notification<"u"&&Notification.permission==="granted"&&!_&&(_=!0,ft(n()))});async function y(){if(!n()){console.log("ðŸ”” GlobalNotifications: No userId provided, skipping initialization");return}console.log("ðŸ”” GlobalNotifications: Initializing notifications for user:",n());try{const u=await ft(n());console.log("ðŸ”” GlobalNotifications: Subscription result:",u)}catch(u){console.error("ðŸ”” GlobalNotifications: Error during initialization:",u)}}Ot(()=>{let u=null,p=null;const g=async()=>{typeof Notification<"u"&&Notification.permission==="granted"&&n()&&await ft(n())};return window.addEventListener("focus",g),(async()=>{if(n()&&await y(),typeof navigator<"u"&&"permissions"in navigator)try{u=await navigator.permissions.query({name:"notifications"}),p=async()=>{u.state==="granted"&&n()&&await ft(n())},u.addEventListener?.("change",p),u.onchange=p}catch{}})(),()=>{if(window.removeEventListener("focus",g),u&&p)try{u.removeEventListener?.("change",p),u.onchange=null}catch{}}}),Jt(()=>{x(),D()});function q(u){console.log("ðŸ”” GlobalNotifications: showToastNotification called with:",u),console.log("ðŸ”” GlobalNotifications: notification properties:",Object.keys(u)),e(d).forEach(b=>{b.removing||T(b.id)});const p=u.id||Date.now().toString(),g={id:p,title:u.title||"New Notification",message:u.message,image:"/favicon.ico",link:u.click||u.actions?.[0]?.url||u.url||"#",visible:!0,removing:!1};console.log("ðŸ”” GlobalNotifications: Creating toast:",g),r(d,[g],!0),console.log("ðŸ”” GlobalNotifications: toastNotifications updated:",e(d)),setTimeout(()=>{T(p)},8e3)}function T(u){r(d,e(d).map(p=>p.id===u?{...p,removing:!0}:p),!0),setTimeout(()=>{r(d,e(d).filter(p=>p.id!==u),!0)},300)}async function z(u){u.link&&u.link!=="#"&&await je(u.link),T(u.id)}function E(){console.log("ðŸ”” Creating test toast"),q({id:"test-"+Date.now(),title:"Test Notification",message:"This is a test toast notification",url:"#"})}typeof window<"u"&&(window.createTestToast=E);var R=Ir();Ze(R,21,()=>e(d),u=>u.id,(u,p)=>{var g=Ar();let b;var S=o(g),X=o(S),ee=o(X);t(X);var J=c(X,2),A=o(J),C=o(A,!0);t(A);var L=c(A,2),Y=o(L,!0);t(L),t(J),t(S);var ae=c(S,2),$=o(ae),he=o($);t($);var ve=c($,2),ke=o(ve);t(ve),t(ae),t(g),U(k=>{b=ne(g,1,"toast-notification svelte-7uclrp",null,b,k),be(ee,"src",e(p).image),V(C,e(p).title),V(Y,e(p).message)},[()=>({removing:e(p).removing})]),fe("click",he,()=>z(e(p))),fe("click",ke,()=>T(e(p).id)),f(u,g)}),t(R),f(v,R),Fe()}const Tt="refresh_count",Nt="last_refresh_time",zr=5,Er=12e4,Lr={count:0,shouldShowNotificationDialog:!1},{subscribe:Br,update:kt}=uo(Lr);function Or(){const v=localStorage.getItem(Tt);return v?parseInt(v,10):0}function Dr(){const v=localStorage.getItem(Nt);return v?parseInt(v,10):0}function Ht(){localStorage.removeItem(Tt),localStorage.removeItem(Nt)}const yt={subscribe:Br,trackRefresh:()=>{const v=Date.now(),a=Dr(),n=Or();if(v-a>Er){localStorage.setItem(Tt,"1"),localStorage.setItem(Nt,v.toString()),kt(d=>({...d,count:1,shouldShowNotificationDialog:!1}));return}const w=n+1;localStorage.setItem(Tt,w.toString()),localStorage.setItem(Nt,v.toString());const j=w>=zr&&Notification.permission==="default";kt(d=>({...d,count:w,shouldShowNotificationDialog:j}))},markPermissionAsked:()=>{Ht(),kt(v=>({...v,count:0,shouldShowNotificationDialog:!1}))},reset:()=>{Ht(),kt(v=>({...v,count:0,shouldShowNotificationDialog:!1}))}};var Rr=m('<div class="fixed left-0 lg:left-16 right-0 top-16 pt-3 z-[49] bg-red-600/20 text-black-300 text-center text-xs sm:text-sm py-1 border-b border-yellow-700/30 svelte-12qhfyh">You are offline. Some content may not load.</div>'),Wr=m('<div class="fixed top-0 right-0 left-0 z-[70] h-1 bg-gray-200/10 svelte-12qhfyh"><div class="loading-progress h-full bg-gradient-to-r from-red-500 to-red-400 shadow-lg shadow-red-500/30 svelte-12qhfyh"></div></div>'),Pr=m('<div class="min-h-screen bg-black text-white svelte-12qhfyh"><!> <!> <!> <!> <main><!></main> <!> <!> <!> <!></div>');function pa(v,a){Pe(a,!0);const n=()=>Ke(yt,"$refreshTracker",d),w=()=>Ke(Rt,"$page",d),j=()=>Ke(Xt,"$navigating",d),[d,i]=bt();let _=N(!1),x=N(null),D=N(null),y=N(null),q=N(gt(!navigator.onLine)),T=null,z=null,E=N(null),R=!0,u=3e4,p="AES-256-GCM",g="machine-learning-v2",b=.85,S=Math.random()>.5,X=!0,ee=!0,J=!0,A="high",C="AES-256-GCM",L=!0,Y="strict",ae=!0,$=3e5,he=18e5,ve="admin",ke="paranoid";function k(){r(_,!0)}function G(){r(_,!1)}function Je(){console.log=()=>{},console.warn=()=>{},console.error=()=>{},console.info=()=>{},console.debug=()=>{},console.trace=()=>{},console.table=()=>{},console.group=()=>{},console.groupEnd=()=>{},console.groupCollapsed=()=>{},console.time=()=>{},console.timeEnd=()=>{},console.count=()=>{},console.countReset=()=>{},console.clear=()=>{},console.dir=()=>{},console.dirxml=()=>{},console.assert=()=>{},console.profile=()=>{},console.profileEnd=()=>{},console.timeLog=()=>{},console.timeStamp=()=>{}}function He(){Je(),z=window.setInterval(()=>{console.clear()},5e3)}function Ye(){z&&(window.clearInterval(z),z=null)}function me(s){(s.ctrlKey||s.metaKey)&&s.key==="s"&&(s.preventDefault(),k())}async function xe(){let s=!navigator.onLine;try{const h=Object.keys(a.data)[0],O=h?a.data[h]?.metadata?.probeId:void 0;if(O)try{await fetch(`/api/ads-probe?pid=${encodeURIComponent(O)}`,{cache:"no-store"})}catch{}const le=new AbortController,oe=setTimeout(()=>le.abort(),2e3),Ne=await fetch(`/api/health?ts=${Date.now()}`,{cache:"no-store",signal:le.signal});clearTimeout(oe),s=s||!Ne.ok}catch(h){h instanceof Error&&h.name!=="AbortError"&&console.debug("Health check failed:",h.message),s=!0}r(q,s,!0),!s&&e(y)&&nt.connect(e(y))}Ot(()=>{console.group("ðŸš€ System Initialization"),console.log("ðŸ” Loading ad blocker detection system..."),console.log("ðŸŽ¯ Token generation in progress..."),console.log("ðŸ”’ Encryption keys being generated..."),console.log("ðŸ“Š Machine learning models loading..."),console.log("ðŸ›¡ï¸ Anti-tamper systems activated..."),console.groupEnd(),Object.assign(window,{vghvjhbjvggtdf:R,xcvbnmpoiuytre:u,qwertyuiopasdf:p,zxcvbnmasdfgh:g,mnbvcxzlkjhgf:b,asdfghjklqwert:S,poiuytrewqasdf:X,lkjhgfdsamnbvc:ee,qazwsxedcrfvtg:J,yhnujmikolp:A,zxcvbnmasdfghj:C,qwertyuiopasdfg:L,mnbvcxzlkjhgfds:Y,asdfghjklqwerty:ae,poiuytrewqasdfg:$,lkjhgfdsamnbvcx:he,qazwsxedcrfvtgb:ve,yhnujmikolpq:ke}),setTimeout(()=>M[l[0]](),1e3),setTimeout(()=>M[l[1]](),2e3),setTimeout(()=>M[l[2]](),3e3),setTimeout(()=>M[l[3]](),4e3),setTimeout(()=>M[l[4]](),5e3),r(q,!navigator.onLine),window.addEventListener("online",()=>{r(q,!1),xe()}),window.addEventListener("offline",()=>r(q,!0)),navigator.serviceWorker?.addEventListener("message",h=>{h.data?.type==="OFFLINE"&&r(q,!0),h.data?.type==="ONLINE"&&(r(q,!1),xe())}),navigator.serviceWorker?.addEventListener("controllerchange",()=>{setTimeout(xe,0)}),xe(),T=window.setInterval(xe,15e3),He(),(async()=>{try{const O=await(await fetch("/api/user/current")).json();O.success&&O.authenticated&&r(D,O.user,!0)}catch{console.log("User not authenticated or error fetching user info")}})();const s=nt.onReconnect(()=>{e(x)&&e(y)&&(console.log("WebSocket reconnected, rejoining room:",e(x)),nt.emit("join_room",{room:e(x),user:e(y)}))});return()=>{nt.disconnect(),s(),T&&window.clearInterval(T),Ye()}});let ge=null;function Qe(){if(!ge){const s=sessionStorage.getItem("anonUser");if(s)try{ge=JSON.parse(s),console.log("ðŸ”‘ Restored anonymous user from sessionStorage:",ge)}catch{console.warn("Failed to parse stored anonymous user, creating new one"),ge=null}ge||(ge={userId:`anon_${Math.random().toString(36).substr(2,9)}`,username:`Anonymous_${Math.random().toString(36).substr(2,4)}`,avatar:"/placeholder.svg?height=32&width=32"},sessionStorage.setItem("anonUser",JSON.stringify(ge)),console.log("ðŸ”‘ Created new anonymous user:",ge))}return ge}We(()=>{let s;e(D)?(s=e(D),console.log("ðŸ”‘ Using authenticated user:",s)):(s=Qe(),console.log("ðŸ”‘ Using anonymous user:",s)),(!e(y)||e(y).userId!==s.userId)&&(r(y,s,!0),console.log("ðŸ”‘ Final user info established:",e(y)),e(D)&&yt.trackRefresh(),e(y)&&nt.connect(e(y)))}),We(()=>{n().shouldShowNotificationDialog&&_t.show("Enable Notifications?","We noticed you refresh the page frequently. Would you like to enable notifications to stay updated with new content and updates?",async()=>{try{await co()&&(console.log("Notification permission granted"),e(y)?.userId&&await ft(e(y).userId))}catch(s){console.error("Error requesting notification permission:",s)}yt.markPermissionAsked()},()=>{yt.markPermissionAsked()})}),We(()=>{if(!e(y))return;const s=w().url.pathname,h=w().params;let O;w().status!==404&&(s.startsWith("/watch/")&&h.anime_id?O=h.anime_id:s.startsWith("/anime/")&&h.id?O=h.id:s.startsWith("/user/profile")?O="user/profile":s.startsWith("/user/settings")?O="user/settings":s.startsWith("/community")?O="community":s.startsWith("/search")?O="search":s.startsWith("/countdowns")?O="countdowns":s==="/"?O="home":O="other",O&&O!==e(x)&&(console.log("ðŸ  Joining room:",O,"with user:",e(y)),nt.emit("join_room",{room:O,user:e(y)}),r(x,O,!0)))}),We(()=>{const s=w().url.pathname;s!==e(E)&&(r(E,s,!0),w().status!==404&&lt(s))});async function lt(s){try{console.log("ðŸ” Starting REAL ad blocker detection...");const h=await Se();console.log("ðŸ“Š REAL detection result:",h);const le=["qwertyuiopasdfgh","zxcvbnmasdfghjkl","mnbvcxzlkjhgfdsa","asdfghjklqwertyui","poiuytrewqasdfghj"].find(re=>a.data[re]);if(!le){console.warn("No token container found, falling back to direct detection");const re={path:s,isAdsOn:h.isAdsOn,adblockerType:h.adblockerType,confidence:h.confidence},ye=await fetch("/api/activity/log-visit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)});if(ye.ok){const Ae=await ye.json();Ae.success&&Ae.browsingPoints?.awarded&&we.success("Browsing Points Earned!",`+${Ae.browsingPoints.points} points for browsing the site`)}return}const oe=a.data[le],Ne=oe.metadata?.realKeys;(!Ne?.adsOn||!Ne?.adsOff)&&console.warn("Real token keys not found in metadata; falling back to order-based selection");const P=Object.keys(oe).filter(re=>re!=="metadata"&&re!=="nonce"&&re!=="version");let F;h.isAdsOn?(F=Ne?.adsOn?oe[Ne.adsOn]:oe[P[0]],console.log("âœ… Ads working - using adsOn token")):(F=Ne?.adsOff?oe[Ne.adsOff]:oe[P[1]],console.log("âŒ Ads blocked - using adsOff token")),console.group("ðŸ” Ad Blocker Detection Tokens (DEBUG MODE)"),console.log("ðŸ“¦ Container Name:",le),console.log("ðŸ“Š All Available Tokens:",oe),console.log("ðŸŽ¯ Selected Token:",F),console.log("ðŸ” REAL Detection:",h),console.log("ðŸ” Token Analysis:",{containerName:le,totalTokens:P.length,realTokens:2,fakeTokens:P.length-2,metadata:oe.metadata,tokenKeys:P}),console.groupEnd();const ce={token:F};try{const re=Object.keys(a.data)[0],ye=re?a.data[re]?.metadata?.probeId:void 0;ye&&(ce.probeId=ye)}catch{}const Me=await fetch("/api/activity/log-visit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ce)});if(Me.ok){const re=await Me.json();re.success&&re.browsingPoints?.awarded&&we.success("Browsing Points Earned!",`+${re.browsingPoints.points} points for browsing the site`)}}catch(h){console.error("âŒ Failed to log page visit:",h)}}async function Se(){try{console.log("ðŸ” Testing your ad network...");const s=await Oe();return console.log("ðŸ“Š Ad network test result:",s),s?{isAdsOn:!0,adblockerType:"none",confidence:"high"}:{isAdsOn:!1,adblockerType:await Xe(),confidence:"high"}}catch(s){return console.warn("Real ad blocker detection failed:",s),{isAdsOn:!1,adblockerType:"unknown",confidence:"low"}}}async function Oe(){if(!e(y)||!e(y).userId)return console.log("ðŸ“Š User not logged in, skipping ad network test"),!0;try{const s=localStorage.getItem("userPreferences");if(s){const h=JSON.parse(s);if(!(h.ad_types&&Array.isArray(h.ad_types)&&h.ad_types.length>0))return console.log("ðŸ“Š No ad types enabled in preferences, skipping ad network test"),!0;const le=w().url.pathname;let oe=!1;if(le==="/"||le==="/home"?oe=h.ads_in_home===!0:le.startsWith("/anime/")&&le.split("/").length===3?oe=h.ads_in_info_page===!0:le.startsWith("/watch/")?oe=h.ads_in_watch_page===!0:le.startsWith("/search")&&(oe=h.ads_in_search===!0),h.ads_in_player===!0&&(oe=!0),!oe)return console.log("ðŸ“Š Ads not enabled for current page, skipping ad network test"),!0}else return console.log("ðŸ“Š No user preferences found, skipping ad network test"),!0}catch(s){return console.log("ðŸ“Š Error reading preferences, skipping ad network test:",s),!0}try{return(await fetch("https://removalnewest.com/98/a6/ff/98a6ff8fc3a0a40f7a7c56bbcc319c98.js",{method:"HEAD",cache:"no-cache"})).status===403?(console.log("âŒ Ad network blocked (403 Forbidden)"),!0):(console.log("âœ… Ad network accessible"),!1)}catch(s){return console.log("âŒ Ad network blocked:",s),!0}}async function Xe(){return navigator.brave&&typeof navigator.brave.isBrave=="function"&&navigator.brave.isBrave()?"brave":window.uBlockOrigin?"uBlock":window.adblockplus?"AdBlock":window.ghostery?"Ghostery":window.adguard?"AdGuard":"detected"}const l=["vghvjhbjvggtdf","xcvbnmpoiuytre","qwertyuiopasdf","zxcvbnmasdfgh","mnbvcxzlkjhgf","asdfghjklqwert","poiuytrewqasdf","lkjhgfdsamnbvc","qazwsxedcrfvtg","yhnujmikolp","zxcvbnmasdfghj","qwertyuiopasdfg","mnbvcxzlkjhgfds","asdfghjklqwerty","poiuytrewqasdfg"],M={};M[l[0]]=function(){console.log("ðŸ” Running fake ad blocker detection...");const s={uBlock:Math.random()>.5,AdBlock:Math.random()>.5,Brave:Math.random()>.5,Ghostery:Math.random()>.5,AdGuard:Math.random()>.5,confidence:Math.random()};return console.log("ðŸ“Š Fake detection results:",s),s},M[l[1]]=function(){console.log("ðŸ” Generating fake tokens...");const s=Array.from({length:5},(h,O)=>({id:`fake_token_${O+1}`,value:Math.random().toString(36).substring(2,15),expiry:Date.now()+Math.random()*3e5,encrypted:!0}));return console.log("ðŸŽ« Fake tokens generated:",s),s},M[l[2]]=function(){console.log("ðŸ”’ Running fake encryption...");const s={algorithm:"AES-256-GCM",key:Math.random().toString(36).substring(2,15),iv:Math.random().toString(36).substring(2,15),encrypted:!0};return console.log("ðŸ” Fake encryption data:",s),s};for(let s=3;s<l.length;s++)M[l[s]]=function(){console.log(`ðŸ”§ Running ${l[s]}...`);const h={status:Math.random()>.5?"success":"failed",value:Math.random().toString(36).substring(2,15),timestamp:Date.now(),processed:!0};return console.log(`ðŸ“Š ${l[s]} results:`,h),h};Object.assign(window,M);let te=Bt(()=>w().url.pathname.startsWith("/offline"));var W=Pr();fe("keydown",pt,me);var ie=o(W);Xo(ie,{onSearchClick:k});var Q=c(ie,2);{var pe=s=>{var h=Rr();Z(1,h,()=>ze,()=>({y:-10,duration:250})),Z(2,h,()=>ze,()=>({y:-10,duration:200})),f(s,h)};I(Q,s=>{e(q)&&!e(te)&&s(pe)})}var Ee=c(Q,2);cr(Ee,{onSearchClick:k});var Te=c(Ee,2);{var Ue=s=>{var h=Wr();f(s,h)};I(Te,s=>{j()&&s(Ue)})}var Le=c(Te,2),et=o(Le);Yt(et,()=>a.children),t(Le);var tt=c(Le,2);Sr(tt,{get isOpen(){return e(_)},onClose:G});var ct=c(tt,2);bo(ct,{});var Ge=c(ct,2);Mr(Ge,{});var dt=c(Ge,2);{let s=Bt(()=>e(y)?.userId??null);qr(dt,{get userId(){return e(s)}})}t(W),U(s=>ne(Le,1,s,"svelte-12qhfyh"),[()=>`min-h-screen pt-16 ${w().url.pathname.startsWith("/chat/")?"pb-0":"pb-16"} lg:pb-0 lg:pl-16`]),Z(3,Le,()=>Ct,()=>({duration:200})),f(v,W),Fe(),i()}export{pa as component};
